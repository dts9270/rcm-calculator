<!doctype html>
<html lang="mr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>RCM ‡§¨‡§ö‡§§ ‡§ï‡•Ö‡§≤‡•ç‡§ï‡•ç‡§Ø‡•Å‡§≤‡•á‡§ü‡§∞ ‚Äî DS WORLD</title>

  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#0a5b99;
      --p2:#003d80;
      --accent:#138808;
      --muted:#666;
      --card:#fff;
      --glass:rgba(255,255,255,0.96);
      --shadow:0 10px 30px rgba(10,30,60,0.12);
    }
    *{box-sizing:border-box;max-width:100%;}
    body{
      margin:0;
      font-family:"Poppins",sans-serif;
      background:linear-gradient(135deg,#063b73,#0a5b99,#003d80);
      color:#111;overflow-x:hidden;
    }
    .container{max-width:1000px;margin:14px auto;padding:14px;}

    .header{
      display:flex;justify-content:space-between;
      align-items:center;gap:12px;flex-wrap:wrap;
      color:#fff;
    }
    .header-left{display:flex;align-items:center;gap:12px}
    .logo{width:60px;height:60px;background:#fff;border-radius:10px;padding:6px;object-fit:contain}
    .title h1{margin:0;font-family:"Baloo 2";font-size:22px}
    .now{font-size:13px;color:#eef;opacity:.9;font-weight:600;margin-top:4px}
    .ds-badge{
      background:linear-gradient(90deg,var(--primary),var(--p2));
      padding:8px 16px;border-radius:30px;
      font-weight:700;color:#fff;
      box-shadow:0 8px 18px rgba(0,0,0,0.2);
    }

    .grid{
      display:grid;grid-template-columns:1fr 330px;gap:14px;
    }
    @media(max-width:900px){.grid{grid-template-columns:1fr}}

    .card{
      background:var(--glass);padding:16px;border-radius:12px;
      border-top:6px solid var(--primary);
      box-shadow:var(--shadow);
    }

    .row{display:flex;gap:10px;flex-wrap:wrap}
    .field{flex:1;min-width:150px}
    .field label{font-size:13px;color:var(--muted)}
    .field input{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eef8}

    .section{margin-top:16px;background:#fff;border:1px solid #eaf4ff;
      padding:14px;border-radius:12px;box-shadow:0 6px 16px rgba(0,80,150,0.04)}
    .section h2{
      font-family:"Baloo 2";color:var(--primary);
      font-size:18px;margin:0 0 10px 0;
      border-bottom:1px solid #eee;padding-bottom:8px;
    }

    .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end}
    select,input.inline-qty{
      padding:10px;border-radius:8px;border:1px solid #e6eef8;background:#fff;
    }
    input.inline-qty{width:80px;text-align:center;}

    #productList{margin-top:10px;max-height:350px;overflow:auto;padding-right:4px}
    .item{background:#fbfdff;border:1px solid #eaf2ff;border-radius:10px;padding:12px;margin-bottom:10px}
    .item .title{font-weight:700;color:var(--primary)}
    .item .meta{font-size:13px;color:var(--muted)}

    .totals{margin-top:12px;border-top:2px solid var(--primary);padding-top:10px}
    .total-row{display:flex;justify-content:space-between;padding:6px 0}

    .side .card{margin-bottom:12px}
    .card-green{background:linear-gradient(135deg,#138808,#0c6a06)!important;color:#fff}
    .card-purple{background:linear-gradient(135deg,#8A56FF,#6a3dcc)!important;color:#fff}
    .card-blue{background:linear-gradient(135deg,#0a5b99,#003d80)!important;color:#fff}

    .btn-green{background:#25D366;color:#fff;width:100%}
    .btn-orange{background:#ff7043;color:#fff;width:100%}
    .btn-red{background:#d72626;color:#fff;width:100%}

    #floatAdd{
      position:fixed;bottom:20px;right:20px;z-index:999;
      width:60px;height:60px;border-radius:50%;
      display:flex;justify-content:center;align-items:center;
      background:linear-gradient(90deg,var(--primary),var(--p2));
      font-size:26px;color:#fff;box-shadow:0 10px 25px rgba(0,0,0,0.3);
    }

    .overlay{
      position:fixed;left:0;top:0;width:100%;height:100%;
      background:rgba(0,0,0,0.3);display:none;
      align-items:center;justify-content:center;z-index:1200;
    }
    .popup{
      background:#fff;padding:20px;border-radius:12px;
      width:320px;max-width:90%;text-align:center;
      box-shadow:0 16px 40px rgba(0,0,0,0.2);
    }
    .confetti{
      position:fixed;font-size:22px;opacity:0;
      pointer-events:none;z-index:1300;
      transform:translateY(0);
    }

    .footer{
      margin-top:16px;text-align:center;
      background:#fff;border-radius:12px;padding:14px;
      border-top:5px solid var(--primary);
      font-weight:700;
    }

    /* small tweaks to prevent horizontal scroll from large elements */
    img, iframe, table { max-width:100%; height:auto; }
  </style>
</head>

<body>

<div class="container">

  <div class="header">
    <div class="header-left">
      <img src="logo.png" class="logo" alt="logo" onerror="this.style.display='none'">
      <div class="title">
        <h1>RCM ‡§¨‡§ö‡§§ ‡§ï‡•Ö‡§≤‡•ç‡§ï‡•ç‡§Ø‡•Å‡§≤‡•á‡§ü‡§∞</h1>
        <div class="now" id="nowDate">--</div>
      </div>
    </div>
    <div class="ds-badge">‚ú® DS WORLD</div>
  </div>

  <div class="grid">

    <div>
      <div class="card">
        <div class="row">
          <div class="field">
            <label>‡§ó‡•ç‡§∞‡§æ‡§π‡§ï‡§æ‡§ö‡•á ‡§®‡§æ‡§µ</label>
            <input id="custName" type="text" placeholder="‡§®‡§æ‡§µ">
          </div>
          <div class="field">
            <label>RCM ID</label>
            <input id="rcmId" type="text" placeholder="RCM ID">
          </div>
          <div class="field">
            <label>‡§ë‡§∞‡•ç‡§°‡§∞ ‡§§‡§æ‡§∞‡•Ä‡§ñ</label>
            <input id="orderDate" type="date">
          </div>
        </div>

        <div class="section">
          <h2>‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§ç‡§° ‡§ï‡§∞‡§æ</h2>

          <input id="search" placeholder="‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§∂‡•ã‡§ß‡§æ..." style="width:100%;margin-bottom:10px;padding:10px;border:1px solid #ddd;border-radius:8px">

          <div class="controls">
            <select id="productSelect" style="flex:1">
              <option value="">-- ‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§®‡§ø‡§µ‡§°‡§æ --</option>
            </select>

            <input id="qtyInput" class="inline-qty" type="number" value="1" min="1">

            <button id="addBtn" class="btn-add">+ ‡§ç‡§°</button>
          </div>

          <div id="productList"></div>

          <div class="totals">
            <div class="total-row"><span>Qty</span><b id="totalQty">0</b></div>
            <div class="total-row"><span>Market</span><b id="totalMarket">‚Çπ0</b></div>
            <div class="total-row"><span>RCM</span><b id="totalRCM">‚Çπ0</b></div>
            <div class="total-row"><span>PV</span><b id="totalPV">0</b></div>
            <div class="total-row"><span>Saving</span><b id="totalSaving">‚Çπ0</b></div>
          </div>

        </div>
      </div>
    </div>

    <div class="side">

      <div class="card card-green">
        <div>üí∞ ‡§è‡§ï‡•Ç‡§£ ‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§´‡§æ‡§Ø‡§¶‡§æ</div>
        <div id="cardMonthly" style="font-size:28px;margin-top:6px">‚Çπ0</div>
      </div>

      <div class="card card-purple">
        <div>üéØ Consistency Reward</div>
        <div id="cardCons" style="font-size:26px;margin-top:6px">‚Çπ0</div>
      </div>

      <div class="card card-blue">
        <div>üèÜ Final Benefit</div>
        <div id="cardTotal" style="font-size:30px;margin-top:6px">‚Çπ0</div>
        <div style="font-size:13px;margin-top:10px">‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï</div>
        <div id="cardAnnual" style="font-size:22px">‚Çπ0</div>
        <div style="font-size:13px;margin-top:8px">20 ‡§µ‡§∞‡•ç‡§∑</div>
        <div id="cardTwenty" style="font-size:22px">‚Çπ0</div>
      </div>

      <div class="card">
        <button id="waBtn" class="btn-green">WhatsApp</button><br><br>
        <button id="imgBtn" class="btn-add" style="width:100%">Share Image</button><br><br>
        <button id="pdfBtn" class="btn-orange">Download PDF</button><br><br>
        <button id="clearBtn" class="btn-red">Clear</button>
      </div>

    </div>
  </div>

  <div class="footer">
    Designed by <b>DS WORLD üåç</b><br>
    üìû 7020970727
  </div>

</div>

<div id="overlay" class="overlay" aria-hidden="true">
  <div class="popup" role="dialog" aria-modal="true">
    <h3 id="popTitle">‚úî ‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§ú‡•ã‡§°‡§≤‡•á</h3>
    <p id="popSub">Saving: ‚Çπ0</p>
  </div>
</div>

<div id="confetti"></div>

<!-- JS Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<script>
/* -------------------------
  Full JavaScript Engine
---------------------------*/
const SHEET =
 "https://docs.google.com/spreadsheets/d/1eR5THz-4AV3HkfnNJ5Un48ksz0I0jrepJSED3qHFg6k/gviz/tq?tqx=out:json";

let products = [];
let order = [];

// DOM refs
const productSelect = document.getElementById("productSelect");
const productList   = document.getElementById("productList");
const qtyInput      = document.getElementById("qtyInput");
const search        = document.getElementById("search");

const totalQty     = document.getElementById("totalQty");
const totalMarket  = document.getElementById("totalMarket");
const totalRCM     = document.getElementById("totalRCM");
const totalPV      = document.getElementById("totalPV");
const totalSaving  = document.getElementById("totalSaving");

const cardMonthly  = document.getElementById("cardMonthly");
const cardCons     = document.getElementById("cardCons");
const cardTotal    = document.getElementById("cardTotal");
const cardAnnual   = document.getElementById("cardAnnual");
const cardTwenty   = document.getElementById("cardTwenty");

/* clock */
function updateTime(){ document.getElementById("nowDate").innerText =
  new Date().toLocaleString("mr-IN",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"short",year:"numeric"}); }
setInterval(updateTime,1000); updateTime();
document.getElementById("orderDate").valueAsDate = new Date();

/* load sheet */
async function loadProducts(){
  try{
    let r = await fetch(SHEET);
    let t = await r.text();
    let json = JSON.parse(t.substring(47,t.length-2));
    products = json.table.rows.map(r=>({
      name: r.c[0]?.v||"",
      market: +r.c[1]?.v||0,
      rcm: +r.c[2]?.v||0,
      pv: +r.c[3]?.v||0
    })).filter(p=>p.name);
  }catch(e){
    // fallback hardcoded minimal list if sheet fails
    products = [
      {name:"‡§ü‡§æ‡§ü‡§æ ‡§Æ‡•Ä‡§† 1 ‡§ï‡§ø‡§≤‡•ã",market:30,rcm:20,pv:7},
      {name:"‡§∞‡•á‡§° ‡§≤‡•á‡§¨‡§≤ ‡§ö‡§π‡§æ ‡§™‡§æ‡§µ‡§°‡§∞ 500 ‡§ó‡•ç‡§∞‡•Ö‡§Æ",market:310,rcm:240,pv:120},
      {name:"‡§®‡•ç‡§Ø‡•Ç‡§ü‡•ç‡§∞‡§ø‡§≤‡§æ‡§á‡§ü",market:560,rcm:320,pv:270}
    ];
  }
  populateDropdown(); loadSavedOrder(); recalc();
}
loadProducts();

function populateDropdown(){
  productSelect.innerHTML = "<option value=''>-- ‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§®‡§ø‡§µ‡§°‡§æ --</option>";
  products.forEach((p,i)=>{
    let o=document.createElement("option"); o.value=i; o.textContent=p.name; productSelect.appendChild(o);
  });
}

/* search */
search.oninput = ()=>{
  let q = search.value.toLowerCase();
  productSelect.innerHTML = "<option value=''>-- ‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§®‡§ø‡§µ‡§°‡§æ --</option>";
  products.forEach((p,i)=>{ if(p.name.toLowerCase().includes(q)){ let o=document.createElement("option"); o.value=i; o.textContent=p.name; productSelect.appendChild(o);} });
};

/* add */
document.getElementById("addBtn").onclick = addProduct;
function addProduct(){
  let idx = productSelect.value; if(idx==="") return alert("‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§®‡§ø‡§µ‡§°‡§æ!");
  let q = Math.max(1, +qtyInput.value || 1);
  let p = products[idx];
  let ex = order.find(o=>o.name===p.name);
  if(ex) ex.qty+=q; else order.push({...p,qty:q});
  saveOrder(); recalc(); showPopup(p.name); fireConfetti();
}

/* save/load */
function saveOrder(){ localStorage.setItem("order",JSON.stringify(order)); localStorage.setItem("order_prev",JSON.stringify(order)); }
function loadSavedOrder(){ let s=localStorage.getItem("order"); if(s) order=JSON.parse(s); }

/* recalc */
function recalc(){
  productList.innerHTML="";
  let tQ=0,tM=0,tR=0,tPV=0,tS=0;
  if(order.length===0) productList.innerHTML="<div style='color:#777'>‡§ë‡§∞‡•ç‡§°‡§∞ ‡§∞‡§ø‡§ï‡§æ‡§Æ‡•Ä ‡§Ü‡§π‡•á.</div>";
  order.forEach((it,i)=>{
    let m=it.market*it.qty, r=it.rcm*it.qty, p=it.pv*it.qty, s=(it.market-it.rcm)*it.qty;
    tQ+=it.qty; tM+=m; tR+=r; tPV+=p; tS+=s;
    let d=document.createElement("div"); d.className="item";
    d.innerHTML = `<div class='title'>${i+1}. ${it.name}</div>
      <div class='meta'>PV: ${it.pv} | Market: ${it.market} | RCM: ${it.rcm}</div>
      <div style='display:flex;gap:10px;margin-top:8px;align-items:center'>
        <input data-i='${i}' type='number' class='inline-qty' value='${it.qty}' min='1'>
        <button data-i='${i}' class='btn-ghost'>Remove</button>
      </div>
      <div style='margin-top:6px;font-weight:700;color:var(--accent)'>Saving: ‚Çπ${s}</div>`;
    productList.appendChild(d);
  });
  document.querySelectorAll(".inline-qty").forEach(el=>{ el.onchange=()=>{ let i=el.dataset.i; order[i].qty=Math.max(1,+el.value||1); saveOrder(); recalc(); } });
  document.querySelectorAll(".item button").forEach(b=>{ b.onclick=()=>{ order.splice(b.dataset.i,1); saveOrder(); recalc(); } });
  totalQty.textContent=tQ; totalMarket.textContent="‚Çπ"+tM; totalRCM.textContent="‚Çπ"+tR; totalPV.textContent=tPV; totalSaving.textContent="‚Çπ"+tS;
  let cons=0; if(tPV<1500) cons=tPV*0.12; else if(tPV<2500) cons=1500*0.1667; else cons=5000*0.1667;
  cardCons.textContent="‚Çπ"+cons.toFixed(0);
  let final=tS+cons;
  cardMonthly.textContent="‚Çπ"+final.toFixed(0); cardTotal.textContent="‚Çπ"+final.toFixed(0);
  cardAnnual.textContent="‚Çπ"+(final*12).toFixed(0); cardTwenty.textContent="‚Çπ"+(final*12*20).toFixed(0);
}

/* popup */
function showPopup(name){ document.getElementById("popTitle").innerText="‚úî "+name+" ‡§ú‡•ã‡§°‡§≤‡•á!"; document.getElementById("popSub").innerText="Total Saving: "+totalSaving.innerText; let o=document.getElementById("overlay"); o.style.display="flex"; setTimeout(()=>o.style.display="none",2000); }

/* confetti */
function fireConfetti(){ let emojis=["üéâ","‚ú®","üéä","üí∞","‚úî"]; for(let i=0;i<10;i++){ let c=document.createElement("div"); c.className="confetti"; c.innerText=emojis[Math.floor(Math.random()*emojis.length)]; c.style.left=Math.random()*window.innerWidth+"px"; c.style.top=window.innerHeight*0.7+"px"; document.body.appendChild(c); setTimeout(()=>{c.style.opacity=1;c.style.transform="translateY(-200px)";},10); setTimeout(()=>c.remove(),1200);} }

/* whatsapp */
document.getElementById("waBtn").onclick=()=>{ let msg="RCM ORDER\n\n"; order.forEach((it,i)=>{ msg+=`${i+1}. ${it.name} ‚Äî Qty:${it.qty}, PV:${it.pv}\n`; }); msg+=`\nTotal PV: ${totalPV.innerText}\nSaving: ${totalSaving.innerText}\nFinal Benefit: ${cardTotal.innerText}`; window.open("https://wa.me/?text="+encodeURIComponent(msg)); };

/* share as image */
document.getElementById("imgBtn").onclick=()=>{ html2canvas(document.body).then(canvas=>{ let a=document.createElement("a"); a.download="RCM_Calculator.png"; a.href=canvas.toDataURL(); a.click(); }); };

/* pdf */
document.getElementById("pdfBtn").onclick=()=>{ html2pdf().set({margin:10,filename:"RCM_Calculator.pdf",html2canvas:{scale:2},jsPDF:{unit:"mm",format:"a4"}}).from(document.body).save(); };

/* clear */
document.getElementById("clearBtn").onclick=()=>{ if(confirm("Clear full order?")){ order=[]; saveOrder(); recalc(); } };

</script>
</body>
</html>
