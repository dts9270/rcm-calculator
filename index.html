<!doctype html>
<html lang="mr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DS WORLD ‚Äî PRO MAX Calculator</title>

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#0a5b99;
  --accent:#0ea44a;
  --muted:#6b7280;
  --bg: linear-gradient(180deg,#f4fbff,#eef5ff);
  --card-bg: rgba(255,255,255,0.7);
  --glass-blur: blur(10px);
  --shadow: 0 10px 30px rgba(12,40,80,0.08);
  --radius:14px;
}
.dark{
  --bg: linear-gradient(180deg,#081018,#07101a);
  --primary:#6fb8ff;
  --accent:#34e18a;
  --card-bg: rgba(20,26,34,0.55);
  --muted:#9aa6b2;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:"Noto Sans Devanagari", sans-serif;
  background:var(--bg);
  color:#0f1724;
  transition:background .25s, color .25s;
}

/* Layout */
.wrap{
  max-width:980px;
  margin:14px auto;
  padding:14px;
}
.header{
  display:flex;justify-content:space-between;align-items:center;
}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:64px;height:64px;border-radius:12px;background:#fff;display:flex;align-items:center;justify-content:center;box-shadow:var(--shadow)}
.title{font-size:20px;font-weight:700;color:var(--primary)}
.now{font-size:13px;color:var(--muted)}

.grid{
  display:grid;
  grid-template-columns:1fr 360px;
  gap:16px;
}
@media(max-width:900px){.grid{grid-template-columns:1fr}}

.card{
  padding:16px;
  border-radius:var(--radius);
  background:var(--card-bg);
  border:1px solid rgba(255,255,255,0.4);
  box-shadow:var(--shadow);
  backdrop-filter:var(--glass-blur);
}

.row{display:flex;gap:12px;flex-wrap:wrap}
.field{flex:1}
label{font-size:13px;color:var(--muted)}
input,select{width:100%;padding:10px;border-radius:10px;border:1px solid #ddd}

.qty{width:100px}

/* Product list */
#productList{margin-top:12px;max-height:340px;overflow:auto}
.product-item{display:flex;justify-content:space-between;gap:12px;padding:12px;background:#fbfdff;border-radius:10px;border:1px solid #eef6ff;margin-bottom:8px}
.product-name{font-weight:700;color:var(--primary)}
.product-meta{font-size:13px;color:var(--muted)}

/* totals */
.totals{margin-top:14px;border-top:1px solid #eee;padding-top:10px}
.total-row{display:flex;justify-content:space-between;padding:6px 0}
.total-row .muted{color:var(--muted);font-weight:600}

/* cards */
.cards-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
.big-card{padding:16px;border-radius:12px;color:#fff;text-align:center;font-weight:800}
.card-saving{background:linear-gradient(135deg,#ff9740,#ff7a26)}
.card-cons{background:linear-gradient(135deg,#a679ff,#6b4be8)}
.card-annual{background:linear-gradient(135deg,#0ea44a,#007c33)}
.card-future{background:linear-gradient(135deg,#04a1ff,#006ae3)}

/* actions */
.btn{padding:10px;border-radius:10px;font-weight:700;border:none;cursor:pointer}
.btn-primary{background:var(--primary);color:#fff}
.btn-ghost{background:#fff;border:1px solid #ccc;color:var(--primary)}

.actions{display:flex;flex-direction:column;gap:10px}

/* floating add */
.fab{position:fixed;right:18px;bottom:20px;width:60px;height:60px;border-radius:50%;font-size:30px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--primary),#0074d2);color:#fff;box-shadow:0 12px 28px rgba(0,0,0,0.2);z-index:999}

/* popup */
#orderPopup{
  position:fixed;left:0;top:0;width:100%;height:100%;
  background:rgba(0,0,0,0.35);
  display:none;justify-content:center;align-items:center;
  z-index:2000;
}
#orderBox{
  background:#fff;padding:20px;border-radius:14px;
  width:92%;max-width:400px;box-shadow:0 12px 30px rgba(0,0,0,0.25);
}
.popup-title{font-weight:700;color:var(--primary);margin-bottom:10px}
.popup-field{margin-bottom:10px}
.popup-field input{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc}

/* footer */
.footer{text-align:center;margin-top:14px;color:var(--muted);font-weight:700}
  /* ===== MOBILE UI OPTIMIZATION ===== */
@media(max-width:600px){

  .wrap{
    padding:10px;
  }

  .grid{
    grid-template-columns:1fr;
    gap:12px;
  }

  .header{
    flex-direction:column;
    gap:6px;
    text-align:center;
  }

  .logo{
    width:52px;
    height:52px;
  }

  .cards-grid{
    grid-template-columns:1fr;
  }

  .big-card{
    padding:14px;
    min-height:100px;
  }

  .product-item{
    flex-direction:column;
    gap:6px;
    padding:10px;
  }

  .product-meta{
    font-size:12px;
  }

  .qty-controls input{
    width:50px !important;
  }

  .actions button{
    width:100%;
  }

  .fab{
    width:52px;
    height:52px;
    font-size:24px;
    right:14px;
    bottom:14px;
  }

  #orderBox{
    width:92%;
    max-width:360px;
  }
}
</style>
<body>

<div class="wrap">

  <header class="header">
    <div class="brand">
      <div class="logo">
        <img src="logo.png" alt="DS" onerror="this.style.display='none'">
      </div>
      <div>
        <div class="title">DS WORLD ‚Äî PRO MAX</div>
        <div class="now" id="nowDate"></div>
      </div>
    </div>

    <div style="display:flex;gap:8px;align-items:center">
      <button id="themeToggle" class="btn btn-ghost">üåô Dark</button>
      <div style="font-weight:800;color:var(--primary)">7020970727</div>
    </div>
  </header>

  <div class="grid">

    <!-- LEFT SIDE -->
    <div class="card">
      <h3 style="margin:0 0 8px 0;color:var(--primary)">PRO MAX ‡§ï‡•Ö‡§≤‡§ï‡•ç‡§Ø‡•Å‡§≤‡•á‡§ü‡§∞</h3>
      <div style="font-size:13px;color:var(--muted);margin-bottom:8px">
        Quantity ‡§¶‡•ç‡§Ø‡§æ ‡§Ü‡§£‡§ø ‡§§‡§æ‡§¨‡§°‡§§‡•ã‡§¨ ‡§´‡§æ‡§Ø‡§¶‡•á ‡§™‡§æ‡§π‡§æ
      </div>

      <div class="row">
        <div class="field">
          <label>Product ‡§®‡§ø‡§µ‡§°‡§æ</label>
          <select id="productSelect">
            <option value="">Loading‚Ä¶</option>
          </select>
        </div>

        <div class="field" style="max-width:110px">
          <label>Qty</label>
          <input id="qtyInput" type="number" value="1" min="1" class="qty">
        </div>

        <div style="align-self:flex-end">
          <button id="addBtn" class="btn btn-primary">+ Add</button>
        </div>
      </div>

      <div id="productList" style="margin-top:12px">
        <div style="text-align:center;color:var(--muted);padding:18px;">
          ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§∞‡§ø‡§ï‡§æ‡§Æ‡•Ä ‡§Ü‡§π‡•á. ‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§®‡§ø‡§µ‡§°‡§æ.
        </div>
      </div>

      <div class="totals">
        <div class="total-row"><span class="muted">‡§è‡§ï‡•Ç‡§£ Qty</span><span id="totalQty">0</span></div>
        <div class="total-row"><span class="muted">Market</span><span id="totalMarket">‚Çπ0</span></div>
        <div class="total-row"><span class="muted">RCM</span><span id="totalRCM">‚Çπ0</span></div>
        <div class="total-row"><span class="muted">PV</span><span id="totalPV">0</span></div>
      </div>

    </div>

    <!-- RIGHT SIDE -->
    <div class="card">

      <div class="cards-grid">

        <div class="big-card card-saving">
          <div style="font-size:13px">‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§´‡§æ‡§Ø‡§¶‡§æ</div>
          <div id="cardMonthly" style="font-size:24px;margin-top:6px">‚Çπ0</div>
        </div>

        <div class="big-card card-cons">
          <div style="font-size:13px">Consistency</div>
          <div id="cardCons" style="font-size:24px;margin-top:6px">‚Çπ0</div>
        </div>

        <div class="big-card card-annual">
          <div style="font-size:13px">‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§¨‡§ö‡§§</div>
          <div id="cardAnnual" style="font-size:24px;margin-top:6px">‚Çπ0</div>
        </div>

        <div class="big-card card-future">
          <div style="font-size:13px">20 ‡§µ‡§∞‡•ç‡§∑‡§æ‡§Ç‡§ö‡•Ä ‡§¨‡§ö‡§§</div>
          <div id="cardTwenty" style="font-size:24px;margin-top:6px">‚Çπ0</div>
        </div>

      </div>

      <div style="margin-top:14px" class="actions">
        <button id="waBtn" class="btn btn-primary">üì≤ WhatsApp Share</button>
        <button id="orderBtn" class="btn btn-primary">üìù Place Order</button>
        <button id="pdfBtn" class="btn btn-ghost">üìÑ Download PDF</button>
        <button id="imgBtn" class="btn btn-ghost">üñº Save Image</button>
        <button id="clearBtn" class="btn btn-ghost">üóë Clear</button>
      </div>

    </div>

  </div>

  <div class="footer">Designed by DS WORLD üåç</div>

</div>

<!-- ORDER POPUP -->
<div id="orderPopup">
  <div id="orderBox">
    <div class="popup-title">Place Order</div>

    <div class="popup-field">
      <input id="custName" placeholder="Customer Name *">
    </div>

    <div class="popup-field">
      <input id="abId" placeholder="AB / RCM ID *">
    </div>

    <div class="popup-field">
      <input id="mob" placeholder="Mobile Number *">
    </div>

    <div class="popup-field">
      <textarea id="addr" rows="3" placeholder="Address *"></textarea>
    </div>

    <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:8px">
      <button id="orderCancel" class="btn btn-ghost">Cancel</button>
      <button id="orderPlace" class="btn btn-primary">Submit</button>
    </div>
  </div>
</div>

<!-- POPUP & CONFETTI -->
<div id="overlay"><div class="popup" id="popupBox">‚úî Product Added</div></div>
<div id="confetti" class="confetti"></div>

<!-- FLOAT BUTTON -->
<div class="fab" id="fab">+</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<script>
const $ = id => document.getElementById(id);
const fmt = n => Math.round(n).toLocaleString("en-IN");

let products = [];
let order = [];

const SHEET_ID = "1eR5THz-4AV3HkfnNJ5Un48ksz0I0jrepJSED3qHFg6k";
const RAW = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;
const API = "https://api.allorigins.win/raw?url=" + encodeURIComponent(RAW);

/* Time update */
setInterval(()=>{
  $("nowDate").innerText = new Date().toLocaleString("mr-IN",{
    day:"2-digit",month:"short",year:"numeric",
    hour:"2-digit",minute:"2-digit"
  });
},1000);

/* THEME */
$("themeToggle").onclick = ()=>{
  document.body.classList.toggle("dark");
  $("themeToggle").innerText = 
    document.body.classList.contains("dark") ? "‚òÄÔ∏è Light" : "üåô Dark";
};

/* LOAD PRODUCTS */
async function loadProducts(){
  try{
    const res = await fetch(API);
    const text = await res.text();
    const json = JSON.parse(text.substring(47,text.length-2));

    products = json.table.rows.map(r=>({
      name : r.c[0]?.v || "",
      market: +r.c[1]?.v || 0,
      rcm   : +r.c[2]?.v || 0,
      pv    : +r.c[3]?.v || 0
    }));

    $("productSelect").innerHTML = 
      `<option value="">-- Product ‡§®‡§ø‡§µ‡§°‡§æ --</option>` +
      products.map((p,i)=>`<option value="${i}">${p.name}</option>`).join("");

  }catch(e){
    alert("Google Sheet error. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§∞‡§§ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ.");
  }
}
loadProducts();

/* PRODUCT ADD */
$("addBtn").onclick = ()=>{
  let i = $("productSelect").value;
  if(i==="") return alert("Product ‡§®‡§ø‡§µ‡§°‡§æ!");

  let qty = Math.max(1, parseInt($("qtyInput").value)||1);
  let p = products[i];

  let ex = order.find(o=>o.name===p.name);
  if(ex) ex.qty += qty;
  else order.push({...p, qty});

  calc();
  showPopup(`${p.name} added`);
};

/* FLOAT BUTTON ‚Üí ADD */
$("fab").onclick = ()=> $("addBtn").click();

/* RENDER + CALC */
function calc(){
  const list = $("productList");
  list.innerHTML = "";

  let tQ=0,tM=0,tR=0,tPV=0,tS=0;

  if(order.length===0){
    list.innerHTML = `<div style='text-align:center;padding:18px;color:var(--muted)'>
      ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§∞‡§ø‡§ï‡§æ‡§Æ‡•Ä ‡§Ü‡§π‡•á.
    </div>`;
  }

  order.forEach((it,i)=>{
    let m=it.market*it.qty;
    let r=it.rcm*it.qty;
    let pv=it.pv*it.qty;
    let s=(it.market-it.rcm)*it.qty;

    tQ+=it.qty; tM+=m; tR+=r; tPV+=pv; tS+=s;

    let div = document.createElement("div");
    div.className="product-item";
    div.innerHTML=`
      <div style="flex:1">
        <div class="product-name">${it.name}</div>
        <div class="product-meta">PV: ${it.pv} | M: ‚Çπ${it.market} | R: ‚Çπ${it.rcm}</div>
      </div>

      <div style="text-align:right">
        <div class="qty-controls" style="display:flex;gap:6px;">
          <button class="btn-ghost" onclick="qtyMinus(${i})">-</button>
          <input type="number" min="1" value="${it.qty}" 
                 onchange="qtySet(${i},this.value)" 
                 style="width:60px;text-align:center">
          <button class="btn-ghost" onclick="qtyPlus(${i})">+</button>
        </div>
        <div style="margin-top:6px;color:var(--accent);font-weight:700">
          ‚Çπ${fmt(s)}
        </div>
      </div>
    `;
    list.appendChild(div);
  });

  $("totalQty").innerText = tQ;
  $("totalMarket").innerText = "‚Çπ"+fmt(tM);
  $("totalRCM").innerText = "‚Çπ"+fmt(tR);
  $("totalPV").innerText = fmt(tPV);

  /* CONSISTENCY */
  let cons = 0;
  if(tPV < 1500) cons = tPV * 0.12;
  else if(tPV < 2500) cons = 1500 * 0.1667;
  else cons = 5000 * 0.1667;

  let monthly = tS + cons;

  $("cardMonthly").innerText = "‚Çπ"+fmt(monthly);
  $("cardCons").innerText = "‚Çπ"+fmt(cons);
  $("cardAnnual").innerText = "‚Çπ"+fmt(monthly*12);
  $("cardTwenty").innerText = "‚Çπ"+fmt(monthly*12*20);
}

/* QTY FUNCTIONS */
function qtyPlus(i){ order[i].qty++; calc(); }
function qtyMinus(i){ order[i].qty=Math.max(1,order[i].qty-1); calc(); }
function qtySet(i,v){ order[i].qty=Math.max(1,parseInt(v)||1); calc(); }

/* CLEAR */
$("clearBtn").onclick = ()=>{
  if(confirm("Clear ‡§ï‡§∞‡§æ‡§Ø‡§ö‡•á?")){
    order=[]; calc();
  }
};

/* POPUP + CONFETTI */
function showPopup(msg){
  $("popupBox").innerText = msg;
  $("overlay").style.display="flex";

  setTimeout(()=> $("overlay").style.display="none", 1300);

  shootConfetti();
}

function shootConfetti(){
  const emojis=["üéâ","‚ú®","üí•","üí∞","üåü"];
  for(let i=0;i<10;i++){
    let d=document.createElement("div");
    d.className="conf";
    d.style.left = (Math.random()*100)+"%";
    d.style.top = "60%";
    d.innerText = emojis[Math.floor(Math.random()*emojis.length)];
    $("confetti").appendChild(d);
    setTimeout(()=> d.remove(),1200);
  }
}

/* WHATSAPP SHARE (FULL TABLE) */
$("waBtn").onclick = ()=>{

  if(order.length===0) return alert("‡§ë‡§∞‡•ç‡§°‡§∞ ‡§∞‡§ø‡§ï‡§æ‡§Æ‡•Ä ‡§Ü‡§π‡•á!");

  let msg = `--------------------------------
RCM Order Summary ‚Äî DS WORLD
--------------------------------\n`;

  order.forEach((it,i)=>{
    msg += `\n${i+1}) ${it.name}
Qty: ${it.qty}
Market: ‚Çπ${it.market}
RCM: ‚Çπ${it.rcm}
PV: ${it.pv}
Saving: ‚Çπ${fmt((it.market-it.rcm)*it.qty)}
--------------------------------`;
  });

  msg += `\nTotal Market: ${$("totalMarket").innerText}
Total RCM: ${$("totalRCM").innerText}
Total PV: ${$("totalPV").innerText}

Monthly Benefit: ${$("cardMonthly").innerText}
Yearly: ${$("cardAnnual").innerText}
20-Year: ${$("cardTwenty").innerText}

‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!
DS WORLD üåç`;

  window.open("https://wa.me/?text="+encodeURIComponent(msg));
};

/* ORDER FORM POPUP */
$("orderBtn").onclick = ()=> $("orderPopup").style.display="flex";
$("orderCancel").onclick = ()=> $("orderPopup").style.display="none";

/* ORDER PLACE */
$("orderPlace").onclick = ()=>{

  let nm = $("custName").value.trim();
  let ab = $("abId").value.trim();
  let mob = $("mob").value.trim();
  let ad = $("addr").value.trim();

  if(!nm || !ab || !mob || !ad)
    return alert("‡§∏‡§∞‡•ç‡§µ ‡§´‡•Ä‡§≤‡•ç‡§° ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§Ü‡§π‡•á‡§§!");

  if(order.length===0)
    return alert("Order ‡§∞‡§ø‡§ï‡§æ‡§Æ‡•Ä ‡§Ü‡§π‡•á!");

  let msg = `üìù ORDER REQUEST ‚Äî DS WORLD
--------------------------------
Name: ${nm}
AB ID: ${ab}
Mobile: ${mob}
Address: ${ad}
--------------------------------\n\n`;

  order.forEach((it,i)=>{
    msg += `${i+1}) ${it.name}
Qty: ${it.qty} | PV: ${it.pv}
Saving: ‚Çπ${fmt((it.market-it.rcm)*it.qty)}
--------------------------------\n`;
  });

  msg += `
Total PV: ${$("totalPV").innerText}
Monthly: ${$("cardMonthly").innerText}
Yearly: ${$("cardAnnual").innerText}

Send via Pro Max App`;

  window.open("https://wa.me/7020970727?text="+encodeURIComponent(msg));

  $("orderPopup").style.display="none";
};

/* IMAGE */
$("imgBtn").onclick = ()=>{
  html2canvas(document.body).then(c=>{
    let a=document.createElement("a");
    a.href=c.toDataURL();
    a.download="RCM_Order.png";
    a.click();
  });
};

/* PDF */
$("pdfBtn").onclick = ()=>{
  html2pdf().from(document.body).save("RCM_Order.pdf");
};
</script>
