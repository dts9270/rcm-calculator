<!doctype html><html lang="mr"><head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>RCM Calculator ‚Äì DS WORLD (PRO MAX)</title>
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
--p:#0a5b99;--p2:#003d80;--green:#138808;
--muted:#666;--card:#fff;--shadow:0 8px 22px rgba(0,0,0,.15);
}
body{margin:0;font-family:"Poppins";background:linear-gradient(135deg,#063b73,#0a5b99,#003d80);color:#111;}
.container{max-width:1000px;margin:auto;padding:14px;}
.header{display:flex;justify-content:space-between;align-items:center;color:#fff;gap:12px;}
.header-left{display:flex;align-items:center;gap:12px;}
.logo{width:60px;height:60px;border-radius:10px;background:#fff;object-fit:contain;padding:5px;}
.header h1{margin:0;font-family:"Baloo 2";font-size:22px;}
.now{font-size:13px;opacity:.9;}
.badge{padding:8px 14px;border-radius:18px;background:linear-gradient(90deg,var(--p),var(--p2));color:#fff;font-weight:700;}
.card{background:#fff;border-radius:12px;padding:14px;box-shadow:var(--shadow);border-top:5px solid var(--p);}
.section h2{margin:0;color:var(--p);font-family:"Baloo 2";font-size:18px;}
.field label{font-size:13px;color:var(--muted);}
.field input,.field select{width:100%;padding:10px;border:1px solid #e8e8e8;border-radius:8px;}
.row{display:flex;gap:10px;flex-wrap:wrap;}
.controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px;}
.inline-qty{padding:8px;border-radius:6px;width:70px;text-align:center;border:1px solid #ddd;}
.btn{padding:10px 14px;border:none;border-radius:8px;font-weight:700;cursor:pointer}
.btn-blue{background:linear-gradient(90deg,var(--p),var(--p2));color:#fff;}
.btn-green{background:#25D366;color:#fff;}
.btn-orange{background:#ff7043;color:#fff;}
.btn-red{background:#d72626;color:#fff;}
.search{padding:10px;border-radius:8px;border:1px solid #e8e8e8;width:100%;}
#productList{margin-top:10px;max-height:350px;overflow:auto;}
.item{background:#f9fcff;border:1px solid #eaf2ff;border-radius:10px;padding:10px;margin-bottom:10px;}
.item-title{font-weight:700;color:var(--p);}
.highlight-green{border-left:4px solid #28a745;padding-left:8px;}
.highlight-yellow{border-left:4px solid #ffc107;padding-left:8px;}
.highlight-grey{border-left:4px solid #aaa;padding-left:8px;}
.row-total{display:flex;justify-content:space-between;padding:8px;color:#000;}
.side{margin-top:14px;}
.card-secondary{background:linear-gradient(135deg,#00796B,#004D40);color:#fff !important;}
.card-secondary div{color:#fff !important;text-shadow:0 1px 3px rgba(0,0,0,.45);}
.progress-line{height:14px;background:#eaf3ff;border-radius:10px;overflow:hidden;margin-top:6px;}
.progress-fill{height:100%;width:0%;background:#00c853;transition:.7s;}
.footer{text-align:center;margin-top:14px;padding:12px;background:#fff;border-top:4px solid var(--p);font-weight:700;}
.overlay{position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.3);}
.popup{background:#fff;padding:20px;border-radius:12px;box-shadow:var(--shadow);}
.confetti{position:fixed;pointer-events:none;opacity:0;transition:1s;font-size:22px;}
@media(max-width:900px){.grid{display:block}}
</style>
</head><body>

<div class="container">

<!---------------- HEADER ---------------->
<div class="header">
  <div class="header-left">
    <img src="logo.png" class="logo" onerror="this.style.display='none'">
    <div>
      <h1>RCM ‡§¨‡§ö‡§§ ‡§ï‡•Ö‡§≤‡•ç‡§ï‡•ç‡§Ø‡•Å‡§≤‡•á‡§ü‡§∞</h1>
      <div class="now" id="nowDate"></div>
    </div>
  </div>
  <div class="badge">DS WORLD üåç</div>
</div>

<!---------------- LAYOUT ---------------->
<div class="grid" style="display:grid;grid-template-columns:1fr 330px;gap:14px;">

<!------------- LEFT PANEL ------------->
<div>
<div class="card">

<div class="row">
  <div class="field" style="flex:1">
    <label>‡§®‡§æ‡§µ</label><input id="custName" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§®‡§æ‡§µ">
  </div>
  <div class="field" style="flex:1">
    <label>RCM ID</label><input id="rcmId" placeholder="RCM ID">
  </div>
  <div class="field" style="flex:1">
    <label>‡§§‡§æ‡§∞‡•Ä‡§ñ</label><input id="orderDate" type="date">
  </div>
</div>

<div class="section" style="margin-top:14px">
<h2>‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§ç‡§° ‡§ï‡§∞‡§æ</h2>

<input id="search" class="search" placeholder="‡§∂‡•ã‡§ß‡§æ...">

<div class="controls">
<select id="productSelect" style="flex:1">
<option value="">-- ‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§®‡§ø‡§µ‡§°‡§æ --</option>
</select>

<input id="qtyInput" class="inline-qty" type="number" min="1" value="1">

<button id="addBtn" class="btn btn-blue">+ ‡§ç‡§°</button>
<button id="repeatBtn" class="btn" style="background:#eee">Repeat</button>
</div>

<div id="productList"></div>

<div class="totals">
<div class="row-total">Qty <b id="totalQty">0</b></div>
<div class="row-total">Market <b id="totalMarket">‚Çπ0</b></div>
<div class="row-total">RCM <b id="totalRCM">‚Çπ0</b></div>
<div class="row-total">PV <b id="totalPV">0</b></div>
<div class="row-total" style="color:#0a5b99;font-weight:700">Saving <b id="totalSaving">‚Çπ0</b></div>
</div>

</div>
</div>
</div>

<!------------- RIGHT PANEL ------------->
<div class="side">

<div class="card card-secondary">
<div>Consistency</div>
<div id="cardCons" style="font-size:22px;margin-top:4px">‚Çπ0</div>
</div>

<div class="card" style="background:linear-gradient(135deg,#138808,#0b6a06);color:#fff">
<div>Total Monthly Benefit</div>
<div id="cardTotal" style="font-size:24px;margin-top:6px">‚Çπ0</div>
</div>

<div class="card card-secondary">
<div>Monthly + Consistency</div>
<div id="cardMonthly" style="font-size:22px;margin-top:4px">‚Çπ0</div>
</div>

<div class="card card-secondary">
<div>Annual Saving</div>
<div id="cardAnnual" style="font-size:20px;margin-top:6px">‚Çπ0</div>
<div style="margin-top:6px">20 Years</div>
<div id="cardTwenty" style="font-size:20px;margin-top:4px">‚Çπ0</div>
</div>

<div class="card">
<div>PV Target</div>
<div style="display:flex;gap:6px;margin-top:6px">
<button class="btn" id="goal1500">1500</button>
<button class="btn" id="goal2500">2500</button>
<button class="btn" id="goal5000">5000</button>
</div>
<div class="progress-line"><div id="progressFill" class="progress-fill"></div></div>
</div>

<div class="card">
<button id="waBtn" class="btn btn-green" style="width:100%">WhatsApp</button>
<button id="pdfBtn" class="btn btn-orange" style="width:100%;margin-top:8px">PDF</button>
<button id="clearBtn" class="btn btn-red" style="width:100%;margin-top:8px">Clear</button>
</div>

</div>
</div>

<!---------------- FOOTER ---------------->
<div class="footer">
Designed By <b>DS WORLD üåç</b><br>
üìû 7020970727
</div>

</div>

<!---------------- POPUP & CONFETTI ---------------->
<div id="overlay" class="overlay">
<div class="popup">
<h3 id="popTitle">‚úî ‡§ú‡•ã‡§°‡§≤‡•á</h3>
<p id="popSub"></p>
</div>
</div>
<div id="confetti"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<script>
/* INIT */
const SHEET="https://docs.google.com/spreadsheets/d/1eR5THz-4AV3HkfnNJ5Un48ksz0I0jrepJSED3qHFg6k/gviz/tq?tqx=out:json";
const CUR='‚Çπ';
let products=[],order=[],pvGoal=1500;

/* DOM */
let nowDate=document.getElementById("nowDate");
let orderDate=document.getElementById("orderDate");
let productSelect=document.getElementById("productSelect");
let productList=document.getElementById("productList");
let search=document.getElementById("search");
let qty=document.getElementById("qtyInput");

let totalQty=document.getElementById("totalQty");
let totalMarket=document.getElementById("totalMarket");
let totalRCM=document.getElementById("totalRCM");
let totalPV=document.getElementById("totalPV");
let totalSaving=document.getElementById("totalSaving");

let cardCons=document.getElementById("cardCons");
let cardMonthly=document.getElementById("cardMonthly");
let cardTotal=document.getElementById("cardTotal");
let cardAnnual=document.getElementById("cardAnnual");
let cardTwenty=document.getElementById("cardTwenty");
let progressFill=document.getElementById("progressFill");

/* TIME */
orderDate.valueAsDate=new Date();
function updateTime(){ nowDate.innerText=new Date().toLocaleString("mr-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})}
updateTime(); setInterval(updateTime,30000);

/* LOAD SHEET */
async function loadProducts(){
 try{
   let r=await fetch(SHEET); let t=await r.text();
   let j=JSON.parse(t.substring(47,t.length-2));
   products=j.table.rows.map(r=>({
      name:r.c[0]?.v||"",market:+r.c[1]?.v||0,rcm:+r.c[2]?.v||0,pv:+r.c[3]?.v||0
   })).filter(x=>x.name);
   populateSelect(); loadStorage(); recalc();
 }catch(e){productSelect.innerHTML="<option>Sheet Error</option>";}
}
function populateSelect(){
 productSelect.innerHTML="<option value=''>-- ‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§®‡§ø‡§µ‡§°‡§æ --</option>";
 products.forEach((p,i)=>{let o=document.createElement("option");o.value=i;o.text=p.name;productSelect.appendChild(o);});
}

/* SEARCH */
search.addEventListener("input",e=>{
 let q=e.target.value.toLowerCase();
 productSelect.innerHTML="<option value=''>-- ‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§®‡§ø‡§µ‡§°‡§æ --</option>";
 products.forEach((p,i)=>{if(!q||p.name.toLowerCase().includes(q)){let o=document.createElement("option");o.value=i;o.text=p.name;productSelect.appendChild(o);}});
});

/* ADD */
document.getElementById("addBtn").onclick=()=>{
 let i=productSelect.value; if(i==="") return alert("‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§®‡§ø‡§µ‡§°‡§æ");
 let q=Math.max(1,+qty.value||1);
 let p=products[i];
 let e=order.find(x=>x.name===p.name);
 if(e) e.qty+=q; else order.push({...p,qty:q});
 saveStorage(); recalc(); popup(p.name); confetti();
 productSelect.selectedIndex=0; qty.value=1;
};

/* STORAGE */
function saveStorage(){localStorage.setItem("order",JSON.stringify(order));localStorage.setItem("prev",JSON.stringify(order));}
function loadStorage(){let s=localStorage.getItem("order");if(s) order=JSON.parse(s);}

/* REPEAT */
document.getElementById("repeatBtn").onclick=()=>{
 let p=localStorage.getItem("prev"); if(!p) return alert("No previous");
 order=JSON.parse(p); saveStorage(); recalc();
};

/* RENDER */
function recalc(){
 productList.innerHTML="";
 let sQ=0,sM=0,sR=0,sPV=0,sS=0;

 if(order.length===0) productList.innerHTML="<div style='color:#888'>‡§∞‡§ø‡§ï‡§æ‡§Æ‡•Ä</div>";

 order.forEach((it,i)=>{
  let ms=it.market*it.qty, rs=it.rcm*it.qty, pv=it.pv*it.qty, sv=(it.market-it.rcm)*it.qty;
  sQ+=it.qty; sM+=ms; sR+=rs; sPV+=pv; sS+=sv;

  let pct=((it.market-it.rcm)/it.market)*100;
  let cls="highlight-grey"; if(pct>=35) cls="highlight-green"; else if(pct>=15) cls="highlight-yellow";

  let d=document.createElement("div");
  d.className="item "+cls;
  d.innerHTML=`
   <div class="item-title">${i+1}. ${it.name}</div>
   <div style="font-size:12px;color:#777">PV:${it.pv} | RCM:${CUR+it.rcm} | MKT:${CUR+it.market}</div>
   <div style="margin-top:6px;display:flex;gap:10px;align-items:center">
     <input data-i="${i}" class="inline-qty" type="number" min="1" value="${it.qty}">
     <button data-i="${i}" class="btn" style="background:#eee">Remove</button>
   </div>
   <div style="margin-top:6px;font-weight:700;color:var(--green)">Saving: ${CUR+sv}</div>
  `;
  productList.appendChild(d);
 });

 document.querySelectorAll(".inline-qty").forEach(x=>{
   x.onchange=()=>{let i=x.dataset.i;order[i].qty=Math.max(1,+x.value||1);saveStorage();recalc();}
 });
 document.querySelectorAll(".item button").forEach(x=>{
   x.onclick=()=>{order.splice(x.dataset.i,1);saveStorage();recalc();}
 });

 totalQty.innerText=sQ;
 totalMarket.innerText=CUR+sM;
 totalRCM.innerText=CUR+sR;
 totalPV.innerText=sPV;
 totalSaving.innerText=CUR+sS;

 /* consistency */
 let c=0;
 if(sPV<1500) c=sPV*.12;
 else if(sPV<2500) c=1500*.1667;
 else c=5000*.1667;

 cardCons.innerText=CUR+c.toFixed(0);
 let comb=sS+c;
 cardMonthly.innerText=CUR+comb.toFixed(0);
 cardTotal.innerText=CUR+comb.toFixed(0);
 cardAnnual.innerText=CUR+(comb*12).toFixed(0);
 cardTwenty.innerText=CUR+(comb*12*20).toFixed(0);

 progressFill.style.width=Math.min(100,(sPV/pvGoal)*100)+"%";
}

/* GOALS */
document.getElementById("goal1500").onclick=()=>{pvGoal=1500;recalc();}
document.getElementById("goal2500").onclick=()=>{pvGoal=2500;recalc();}
document.getElementById("goal5000").onclick=()=>{pvGoal=5000;recalc();}

/* POPUP */
function popup(n){
 document.getElementById("popTitle").innerText="‚úî "+n;
 document.getElementById("popSub").innerText="Saving: "+totalSaving.innerText;
 let o=document.getElementById("overlay");
 o.style.display="flex";
 setTimeout(()=>o.style.display="none",2500);
}

/* CONFETTI */
function confetti(){
 let c=document.getElementById("confetti"), e=["üéâ","‚ú®","üéä","üí∞"];
 for(let i=0;i<10;i++){
  let d=document.createElement("div"); d.className="confetti";
  d.innerText=e[Math.floor(Math.random()*e.length)];
  d.style.left=Math.random()*window.innerWidth+"px";
  d.style.top=(window.innerHeight*.5)+"px";
  document.body.appendChild(d);
  setTimeout(()=>{d.style.opacity=1;d.style.transform="translateY(-200px)"},10);
  setTimeout(()=>d.remove(),1200);
 }
}

/* WHATSAPP */
document.getElementById("waBtn").onclick=()=>{
 let msg=`RCM ORDER\n\n`;
 order.forEach((it,i)=> msg+=`${i+1}. ${it.name} - Qty:${it.qty}, PV:${it.pv}\n`);
 msg+=`\nTotal PV: ${totalPV.innerText}\nSaving: ${totalSaving.innerText}`;
 window.open("https://wa.me/?text="+encodeURIComponent(msg));
};

/* PDF */
document.getElementById("pdfBtn").onclick=()=>{
 let opt={margin:10,filename:"RCM.pdf",html2canvas:{scale:2},jsPDF:{unit:"mm",format:"a4"}};
 html2pdf().set(opt).from(document.body).save();
};

/* CLEAR */
document.getElementById("clearBtn").onclick=()=>{
 if(confirm("Clear?")){order=[];saveStorage();recalc();}
};

/* LOAD */
loadProducts();
</script>

</body></html>
