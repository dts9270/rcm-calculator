<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DS WORLD ‚Äì RCM PRO MAX</title>

<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
/* LIGHT MODE */
:root{
  --primary:#0a5b99;
  --accent:#0ea44a;
  --muted:#6b7280;

  --bg: linear-gradient(180deg,#dff1ff,#e7edff,#ece3ff);
  --text:#0f1724;

  --card-bg: rgba(255,255,255,0.55);
  --card-blur: blur(18px);
  --card-border: rgba(255,255,255,0.38);
}

/* DARK MODE */
.dark{
  --bg: linear-gradient(180deg,#0c1016,#05060a);
  --text:#e7ebf2;
  --primary:#4fa7ff;
  --accent:#00ff99;
  --card-bg: rgba(30,35,42,0.55);
  --card-border: rgba(88,108,146,0.32);
}

body{
  margin:0;
  font-family:"Poppins",sans-serif;
  background:var(--bg);
  color:var(--text);
  transition:0.25s ease;
}

.wrap{
  max-width:1150px;
  margin:18px auto;
  padding:18px;
}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.brand{
  display:flex;
  align-items:center;
  gap:16px;
}

.logo{
  width:62px;height:62px;
  border-radius:14px;
  overflow:hidden;
  display:flex;
  justify-content:center;
  align-items:center;
  background:#fff;
}

h1{
  margin:0;
  font-family:"Baloo 2";
  color:var(--primary);
}

.now{font-size:13px;color:var(--muted)}

#themeToggle{
  padding:10px 18px;
  border:none;
  border-radius:30px;
  background:linear-gradient(135deg,#0095ff,#006fbd);
  color:#fff;
  font-weight:700;
}

.grid{
  display:grid;
  grid-template-columns:1fr 350px;
  gap:16px;
}
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
}

.card{
  background:var(--card-bg);
  border:1px solid var(--card-border);
  backdrop-filter:var(--card-blur);
  border-radius:16px;
  padding:18px;
}

input,select{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--card-border);
  background:rgba(255,255,255,0.5);
}

.product-item{
  display:flex;
  justify-content:space-between;
  margin-bottom:12px;
  padding:12px;
  background:rgba(255,255,255,0.45);
  border-radius:14px;
  border:1px solid var(--card-border);
}

.product-title{font-weight:700;color:var(--primary)}
.product-meta{font-size:13px;color:var(--muted)}

.qty-controls{
  display:flex;
  gap:6px;
}

.btn-ghost{
  padding:6px 12px;
  background:#fff2;
  border:1px solid var(--card-border);
  border-radius:8px;
  font-weight:700;
}

.big-card{
  border-radius:18px;
  padding:18px;
  color:#fff;
  margin-bottom:12px;
}

.card-saving{background:linear-gradient(135deg,#32cc7f,#0ea44a)}
.card-cons{background:linear-gradient(135deg,#9f59ff,#6d3be8)}
.card-year{background:linear-gradient(135deg,#0099ff,#006fe1)}
.card-life{background:linear-gradient(135deg,#ff9d42,#ff7b00)}

.ios-btn{
  width:100%;
  padding:14px;
  border-radius:30px;
  font-weight:700;
  color:#fff;
  border:none;
  margin-bottom:10px;
}
.ios-wa{background:#1bd741}
.ios-img{background:#4890ff}
.ios-pdf{background:#ff7a1c}
.ios-clear{background:#ff4a4a}

.floating-add{
  position:fixed;
  right:20px;
  bottom:20px;
  width:60px;
  height:60px;
  border-radius:50%;
  border:none;
  background:linear-gradient(135deg,var(--primary),#006fbd);
  color:#fff;
  font-size:33px;
}
</style>

</head>
<body>

<div class="wrap">
  <header>
  <div class="brand">
    <div class="logo"><img src="logo.png" style="width:100%"></div>
    <div>
      <h1>RCM ‡§¨‡§ö‡§§ ‡§ï‡•Ö‡§≤‡•ç‡§ï‡•ç‡§Ø‡•Å‡§≤‡•á‡§ü‡§∞ (Pro Max)</h1>
      <div class="now" id="nowDate"></div>
    </div>
  </div>

  <button id="themeToggle">üåô Dark</button>
</header>

<div class="grid">

<!-- LEFT SIDE -->
<div class="card">
  <h3 style="color:var(--primary);margin-top:0">‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä</h3>

  <div style="display:flex;gap:12px;flex-wrap:wrap">
    <div style="flex:1">
      <label>‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§®‡§æ‡§µ</label>
      <input id="custName">
    </div>

    <div style="flex:1">
      <label>RCM ID</label>
      <input id="rcmId">
    </div>

    <div style="flex:1">
      <label>‡§ë‡§∞‡•ç‡§°‡§∞ ‡§§‡§æ‡§∞‡•Ä‡§ñ</label>
      <input id="orderDate" type="date">
    </div>
  </div>

  <h3 style="color:var(--primary);margin-top:20px">‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§ç‡§° ‡§ï‡§∞‡§æ</h3>

  <div style="display:flex;gap:12px;margin-top:10px">
    <select id="productSelect">
      <option value="">-- Select Product --</option>
    </select>

    <input id="qtyInput" type="number" value="1" min="1" style="width:80px">

    <button id="addBtn" style="padding:10px 14px;background:var(--primary);color:#fff;border:none;border-radius:10px;font-weight:700">+ Add</button>
  </div>

  <div id="productList" style="max-height:360px;overflow-y:auto;margin-top:16px"></div>

  <div style="margin-top:16px">
    <p><b>Total Qty:</b> <span id="totalQty">0</span></p>
    <p><b>Total Market:</b> ‚Çπ<span id="totalMarket">0</span></p>
    <p><b>Total RCM:</b> ‚Çπ<span id="totalRCM">0</span></p>
    <p><b>Total PV:</b> <span id="totalPV">0</span></p>
  </div>
</div>

<!-- RIGHT SIDE -->
<div>

  <div class="big-card card-saving">
    <div class="label">üí∞ ‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§´‡§æ‡§Ø‡§¶‡§æ</div>
    <div class="val" id="cardMonthly">‚Çπ0</div>
  </div>

  <div class="big-card card-cons">
    <div class="label">üéØ Consistency</div>
    <div class="val" id="cardCons">‚Çπ0</div>
  </div>

  <div class="big-card card-year">
    <div class="label">üìÖ ‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§´‡§æ‡§Ø‡§¶‡§æ</div>
    <div class="val" id="cardAnnual">‚Çπ0</div>
  </div>

  <div class="big-card card-life">
    <div class="label">üèÜ 20 ‡§µ‡§∞‡•ç‡§∑‡§æ‡§ö‡§æ ‡§´‡§æ‡§Ø‡§¶‡§æ</div>
    <div class="val" id="cardTwenty">‚Çπ0</div>
  </div>

  <div class="card">
    <button id="waBtn" class="ios-btn ios-wa">üì≤ WhatsApp Share</button>
    <button id="imgBtn" class="ios-btn ios-img">üñº Save Image</button>
    <button id="pdfBtn" class="ios-btn ios-pdf">üìÑ Download PDF</button>
    <button id="clearBtn" class="ios-btn ios-clear">üóë Clear Order</button>
  </div>

  <div class="card" style="margin-top:14px;text-align:center">
    <button id="orderBtn" style="padding:14px 20px;border:none;border-radius:30px;background:linear-gradient(135deg,#ff9800,#ff5722);color:#fff;font-size:16px;font-weight:700;width:100%">
      üõí Place Order
    </button>
  </div>

</div>

</div> <!-- GRID END -->

<!-- ORDER POPUP -->
<div id="orderPopup" style="
  position:fixed;left:0;top:0;width:100%;height:100%;
  background:rgba(0,0,0,0.4);display:none;
  justify-content:center;align-items:center;z-index:999;">
  
  <div style="background:#fff;padding:20px;border-radius:16px;width:90%;max-width:380px">
    <h3 style="margin-top:0;color:var(--primary)">Order Details</h3>

    <label>‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§®‡§æ‡§µ</label>
    <input id="oName">

    <label>AB ID</label>
    <input id="oId">

    <label>‡§Æ‡•ã‡§¨‡§æ‡§à‡§≤ ‡§®‡§Ç‡§¨‡§∞</label>
    <input id="oMob">

    <label>‡§™‡§§‡•ç‡§§‡§æ</label>
    <input id="oAddr">

    <button id="orderPlace" style="
      width:100%;margin-top:14px;padding:12px;
      background:var(--primary);color:#fff;border:none;
      border-radius:10px;font-weight:700">Place Order</button>

    <button onclick="orderPopup.style.display='none'" style="
      width:100%;margin-top:10px;padding:12px;
      background:#bbb;color:#fff;border:none;
      border-radius:10px;font-weight:700">Cancel</button>
  </div>

</div>

<footer style="text-align:center;padding:18px;color:var(--muted);font-weight:700">
  Designed by DS WORLD üåç | 7020970727
</footer>

</div> <!-- WRAP END -->

<button class="floating-add" id="floatAdd">+</button>
<!-- LIBRARIES -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<script>
/* Short Helper Functions */
const $ = id => document.getElementById(id);
const fmt = n => Math.round(n).toLocaleString("en-IN");

/* TIME */
setInterval(() => {
  $("nowDate").innerText = new Date().toLocaleString("mr-IN", {
    day:"2-digit",month:"short",year:"numeric",
    hour:"2-digit",minute:"2-digit"
  });
}, 1000);

/* Theme Toggle */
$("themeToggle").onclick = () => {
  document.body.classList.toggle("dark");
  $("themeToggle").innerText =
    document.body.classList.contains("dark") ? "‚òÄÔ∏è Light" : "üåô Dark";
};

/* Load Products from Google Sheet (via CORS Proxy) */
const SHEET_ID = "1eR5THz-4AV3HkfnNJ5Un48ksz0I0jrepJSED3qHFg6k";
const RAW = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;
const URL = "https://api.allorigins.win/raw?url=" + encodeURIComponent(RAW);

let products = [];
let order = [];

/* Load Products */
async function loadProducts() {
  try {
    const r = await fetch(URL);
    const t = await r.text();
    const j = JSON.parse(t.substring(47, t.length - 2));

    products = j.table.rows.map(r => ({
      name: r.c[0]?.v || "",
      market: +r.c[1]?.v || 0,
      rcm: +r.c[2]?.v || 0,
      pv: +r.c[3]?.v || 0
    }));
  } catch (e) {
    products = [
      {name:"‡§ü‡§æ‡§ü‡§æ ‡§Æ‡•Ä‡§† 1 ‡§ï‡§ø‡§≤‡•ã",market:30,rcm:20,pv:7},
      {name:"‡§∞‡•á‡§° ‡§≤‡•á‡§¨‡§≤ ‡§ö‡§π‡§æ 500g",market:310,rcm:240,pv:120}
    ];
  }

  $("productSelect").innerHTML =
    `<option value="">-- Product ‡§®‡§ø‡§µ‡§°‡§æ --</option>` +
    products.map((p,i)=>
      `<option value="${i}">${p.name}</option>`
    ).join("");
}
loadProducts();

/* Add Product */
$("addBtn").onclick = () => {
  const idx = $("productSelect").value;
  if (!idx) return alert("‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§®‡§ø‡§µ‡§°‡§æ!");

  const qty = Math.max(1, parseInt($("qtyInput").value) || 1);
  const p = products[idx];

  const ex = order.find(o => o.name === p.name);
  if (ex) ex.qty += qty;
  else order.push({ ...p, qty });

  calc();
};

/* Floating Add Button */
$("floatAdd").onclick = () => $("addBtn").click();

/* Consistency Reward */
function consistencyReward(pv) {
  if (pv < 1500) return pv * 0.12;
  if (pv < 2500) return 1500 * 0.1667;
  return 5000 * 0.1667;
}

/* Calculate & Render */
function calc() {
  let tQ=0, tM=0, tR=0, tPV=0, tSave=0;

  $("productList").innerHTML = "";

  order.forEach((it,i)=>{
    let m = it.market * it.qty;
    let r = it.rcm * it.qty;
    let pv = it.pv * it.qty;
    let s = (it.market - it.rcm) * it.qty;

    tQ+=it.qty; tM+=m; tR+=r; tPV+=pv; tSave+=s;

    $("productList").innerHTML += `
      <div class="product-item">
        <div>
          <div class="product-title">${i+1}. ${it.name}</div>
          <div class="product-meta">
            PV: ${it.pv} | M: ‚Çπ${it.market} | RCM: ‚Çπ${it.rcm}
          </div>
        </div>

        <div style="text-align:right">
          <div class="qty-controls">
            <button class="btn-ghost" onclick="order[${i}].qty=Math.max(1,order[${i}].qty-1);calc()">-</button>

            <input type="number" min="1" value="${it.qty}"
              onchange="order[${i}].qty=this.value;calc()"
              style="width:50px;text-align:center">

            <button class="btn-ghost" onclick="order[${i}].qty++;calc()">+</button>
          </div>

          <div style="margin-top:6px;font-weight:700;color:green">
            ‚Çπ${fmt(s)}
          </div>
        </div>
      </div>`;
  });

  $("totalQty").innerText = tQ;
  $("totalMarket").innerText = fmt(tM);
  $("totalRCM").innerText = fmt(tR);
  $("totalPV").innerText = fmt(tPV);

  const cons = consistencyReward(tPV);
  const monthly = tSave + cons;

  $("cardMonthly").innerText = "‚Çπ"+fmt(monthly);
  $("cardCons").innerText     = "‚Çπ"+fmt(cons);
  $("cardAnnual").innerText   = "‚Çπ"+fmt(monthly * 12);
  $("cardTwenty").innerText   = "‚Çπ"+fmt(monthly * 12 * 20);
}

/* Clear Order */
$("clearBtn").onclick = () => {
  if (confirm("Order Clear ‡§ï‡§∞‡§æ‡§Ø‡§ö‡§æ?")) {
    order = [];
    calc();
  }
};

/* WhatsApp Share */
$("waBtn").onclick = () => {
  if (order.length === 0) return alert("Order ‡§∞‡§ø‡§ï‡§æ‡§Æ‡•Ä ‡§Ü‡§π‡•á!");

  let msg = "üõí *RCM Order Summary ‚Äî DS WORLD*\n\n";

  order.forEach((it,i)=>{
    msg += `*${i+1}) ${it.name}*\n`;
    msg += `Qty: ${it.qty}\n`;
    msg += `Market: ‚Çπ${it.market}\n`;
    msg += `RCM: ‚Çπ${it.rcm}\n`;
    msg += `PV: ${it.pv}\n`;
    msg += `Saving: ‚Çπ${(it.market - it.rcm) * it.qty}\n`;
    msg += "----------------------\n";
  });

  msg += `\nTotal PV: ${$("totalPV").innerText}`;
  msg += `\nMonthly: ${$("cardMonthly").innerText}`;
  msg += `\nYearly: ${$("cardAnnual").innerText}`;
  msg += `\n20 Years: ${$("cardTwenty").innerText}`;
  msg += `\n\n‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!\nDS WORLD üåç`;

  window.open("https://wa.me/?text="+encodeURIComponent(msg));
};

/* ORDER POPUP */
$("orderBtn").onclick = () => $("orderPopup").style.display="flex";

/* PLACE ORDER */
$("orderPlace").onclick = () => {
  let n = $("oName").value.trim();
  let id = $("oId").value.trim();
  let m = $("oMob").value.trim();
  let a = $("oAddr").value.trim();

  if (!n || !id || !m || !a){
    alert("‡§∏‡§∞‡•ç‡§µ ‡§´‡•Ä‡§≤‡•ç‡§° ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§Ü‡§π‡•á‡§§!");
    return;
  }

  let msg = `üìù *Order Request ‚Äî DS WORLD*\n\n`;
  msg += `Name: ${n}\nAB ID: ${id}\nMobile: ${m}\nAddress: ${a}\n\n`;
  msg += "-----------------------\n";

  order.forEach((it,i)=>{
    msg += `${i+1}) ${it.name} ‚Äî Qty: ${it.qty}\n`;
  });

  msg += `\nTotal PV: ${$("totalPV").innerText}`;
  msg += `\nMonthly: ${$("cardMonthly").innerText}`;

  window.open("https://wa.me/7020970727?text=" + encodeURIComponent(msg));

  $("orderPopup").style.display="none";
};

/* IMAGE DOWNLOAD */
$("imgBtn").onclick = () => {
  html2canvas(document.querySelector(".wrap")).then(canvas=>{
    let a = document.createElement("a");
    a.href = canvas.toDataURL();
    a.download = "RCM_Order.png";
    a.click();
  });
};

/* PDF DOWNLOAD */
$("pdfBtn").onclick = () => {
  html2pdf().from(document.querySelector(".wrap")).save("RCM_Invoice.pdf");
};
</script>
</body>
</html>
