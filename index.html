<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RCM ‡§¨‡§ö‡§§ ‡§ï‡•Ö‡§≤‡•ç‡§ï‡•ç‡§Ø‡•Å‡§≤‡•á‡§ü‡§∞ ‚Äî DS WORLD</title>

<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&family=Poppins:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#0a5b99;
  --primary-2:#003d80;
  --accent:#138808;
  --purple:#8A56FF;
  --card:#ffffff;
  --text:#222;
  --muted:#666;
  --border:#e0e0e0;
  --shadow:0 10px 30px rgba(15,40,80,0.12);
}

/* Background */
body{
  margin:0;
  font-family:"Poppins",sans-serif;
  background: linear-gradient(135deg, #0a5b99 0%, #004f88 50%, #003d80 100%);
  color:var(--text);
}

/* Layout */
.container{ max-width:960px; margin:16px auto; padding:14px; }

.wrap{
  background:rgba(255,255,255,0.97);
  border-radius:14px;
  padding:18px;
  box-shadow:var(--shadow);
  border-top:5px solid var(--primary);
}

/* Header */
.header-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:10px;
  padding:6px 4px;
  box-shadow:0 6px 18px rgba(0,0,0,0.20);
  border-radius:10px;
}
.header-left{
  display:flex;
  align-items:center;
  gap:12px;
}
.logo-img{
  width:58px;
  height:58px;
  object-fit:contain;
  border-radius:8px;
  background:#fff;
}
.pro-title h1{
  margin:0;
  font-family:"Baloo 2",sans-serif;
  color:#ffffff;
  font-size:22px;
}
.pro-title .sub{
  font-size:14px;
  color:#eaf3ff;
  font-weight:600;
  letter-spacing:0.3px;
  text-shadow:0 1px 2px rgba(0,0,0,0.45);
  margin-top:3px;
}
.ds-badge{
  background:linear-gradient(90deg,var(--primary),var(--primary-2));
  padding:8px 14px;
  border-radius:25px;
  color:#fff;
  font-weight:700;
  font-size:14px;
  box-shadow:0 6px 18px rgba(0,0,0,0.12);
}

/* Customer Section */
.customer-info{
  display:flex;
  flex-wrap:wrap;
  gap:14px;
  margin-top:12px;
}
.cust-field{ flex:1; min-width:200px; }
.cust-field label{
  color:var(--muted);
  font-size:13px;
  margin-bottom:6px;
  display:block;
}
.cust-field input{
  padding:10px;
  border-radius:8px;
  border:1px solid var(--border);
  width:100%;
}

/* Section */
.section{
  background:#fff;
  border-radius:12px;
  padding:16px;
  margin-top:14px;
  border:1px solid #eaf1f8;
  box-shadow:0 6px 18px rgba(0,80,150,0.03);
}
.section h2{
  font-family:"Baloo 2",sans-serif;
  font-size:18px;
  margin:0 0 10px 0;
  color:var(--primary);
  border-bottom:1px solid #f3f3f3;
  padding-bottom:6px;
}

/* Controls */
.controls{
  display:flex;
  gap:10px;
  align-items:flex-end;
  flex-wrap:wrap;
}
select, input[type="number"], input[type="text"], input[type="date"]{
  padding:10px;
  border-radius:8px;
  border:1px solid var(--border);
  width:100%;
  background:#fff;
}
.control-group{ flex:1; }
.control-group.qty{ flex:0 1 110px; }
.btn{
  padding:10px 14px;
  border-radius:10px;
  border:none;
  font-weight:700;
  cursor:pointer;
  box-shadow:0 6px 16px rgba(0,0,0,0.06);
}
.btn.add{
  background:linear-gradient(90deg,var(--primary),var(--primary-2));
  color:#fff;
  width:100%;
}

/* Product list */
#productList{ margin-top:14px; }
.empty-msg{ text-align:center; padding:14px 0; color:var(--muted); }
.product-item{
  background:#fbfdff;
  padding:12px;
  margin-bottom:12px;
  border-radius:10px;
  border:1px solid var(--border);
}
.product-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.product-name{
  font-weight:700;
  color:var(--primary);
  font-size:15px;
}
.btn-remove{
  padding:6px 10px;
  background:#fff;
  border:1px solid #ffdcdc;
  color:#c62828;
  border-radius:8px;
}
.product-body{
  margin-top:8px;
  display:flex;
  flex-wrap:wrap;
  gap:10px;
}
.product-saving{
  font-size:15px;
  font-weight:700;
  color:var(--accent);
}

/* Totals */
.totals-summary{
  margin-top:12px;
  padding-top:10px;
  border-top:2px solid var(--primary);
}
.total-row{
  display:flex;
  justify-content:space-between;
  padding:8px 10px;
}
.total-row.highlight{
  border-left:4px solid var(--primary);
  background:#eef8ff;
  border-radius:6px;
}

/* Cards */
.cards-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:14px;
}
.card{
  padding:16px;
  border-radius:12px;
  color:#fff;
  font-weight:700;
  text-align:center;
  box-shadow:0 10px 30px rgba(0,0,0,0.08);
}
.card.saving{ background:linear-gradient(135deg,#ff9933,#ff7b07); }
.card.cons{ background:linear-gradient(135deg,#8A56FF,#6833CC); }
.card.total{ background:linear-gradient(135deg,#138808,#0b6a06); grid-column:1/-1; }
.card.secondary{ background:linear-gradient(135deg,#00796B,#004D40); }

/* Buttons */
.actions-row{
  margin-top:16px;
  display:flex;
  gap:12px;
  justify-content:center;
  flex-wrap:wrap;
}

/* Footer */
.footer{
  margin-top:20px;
  background:#ffffffdd;
  padding:16px 10px;
  text-align:center;
  border-radius:10px;
  border-top:3px solid var(--primary);
  box-shadow:0 6px 18px rgba(0,0,0,0.08);
}

/* Popup */
.overlay{
  position:fixed; left:0; top:0; width:100%; height:100%;
  background:rgba(0,0,0,0.25);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1200;
}
.popup{
  background:#fff;
  padding:22px;
  border-radius:12px;
  width:90%;
  max-width:380px;
  text-align:center;
  box-shadow:0 12px 35px rgba(0,0,0,0.2);
}
.confetti{
  position:fixed;
  font-size:22px;
  pointer-events:none;
  opacity:0;
  transition:1s;
  z-index:2000;
}

/* Responsive */
@media(max-width:720px){
  .header-row{ flex-direction:column; align-items:flex-start; }
  .ds-badge{ align-self:flex-end; }
}
</style>
</head>

<body>
<div class="container">

  <!-- HEADER -->
  <div class="header-row">
    <div class="header-left">
      <img src="logo.png" class="logo-img" alt="Logo" onerror="this.style.display='none'">
      <div class="pro-title">
        <h1>RCM ‡§¨‡§ö‡§§ ‡§ï‡•Ö‡§≤‡•ç‡§ï‡•ç‡§Ø‡•Å‡§≤‡•á‡§ü‡§∞</h1>
        <div class="sub" id="nowDate"></div>
      </div>
    </div>
    <div class="ds-badge">‚ú® DS WORLD</div>
  </div>

  <div class="wrap">

    <!-- Customer Info -->
    <div class="customer-info">
      <div class="cust-field">
        <label>‡§ó‡•ç‡§∞‡§æ‡§π‡§ï‡§æ‡§ö‡•á ‡§®‡§æ‡§µ</label>
        <input id="custName" type="text">
      </div>
      <div class="cust-field">
        <label>RCM ID</label>
        <input id="rcmId" type="text">
      </div>
      <div class="cust-field">
        <label>‡§ë‡§∞‡•ç‡§°‡§∞ ‡§§‡§æ‡§∞‡•Ä‡§ñ</label>
        <input id="orderDate" type="date">
      </div>
    </div>

    <!-- Add product -->
    <div class="section">
      <h2>‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§ç‡§° ‡§ï‡§∞‡§æ</h2>
      <div class="controls">
        <div class="control-group">
          <label>‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§®‡§ø‡§µ‡§°‡§æ</label>
          <select id="productSelect">
            <option value="">-- ‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§®‡§ø‡§µ‡§°‡§æ --</option>
          </select>
        </div>
        <div class="control-group qty">
          <label>Qty</label>
          <input type="number" id="qtyInput" value="1" min="1">
        </div>
        <button class="btn add" id="addBtn">+ ‡§ç‡§° ‡§ï‡§∞‡§æ</button>
      </div>
    </div>

    <!-- ORDER LIST -->
    <div class="section">
      <h2>‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§ë‡§∞‡•ç‡§°‡§∞</h2>
      <div id="productList"></div>

      <div class="totals-summary">
        <div class="total-row"><span>Qty:</span><strong id="totalQty">0</strong></div>
        <div class="total-row"><span>‡§Æ‡§æ‡§∞‡•ç‡§ï‡•á‡§ü ‡§ï‡§ø‡§Ç‡§Æ‡§§:</span><strong id="totalMarket">‚Çπ0</strong></div>
        <div class="total-row"><span>RCM ‡§ï‡§ø‡§Ç‡§Æ‡§§:</span><strong id="totalRCM">‚Çπ0</strong></div>
        <div class="total-row"><span>PV:</span><strong id="totalPV">0</strong></div>
        <div class="total-row highlight"><span>‡§è‡§ï‡•Ç‡§£ ‡§¨‡§ö‡§§:</span><strong id="totalSaving">‚Çπ0</strong></div>
      </div>
    </div>

    <!-- BENEFITS -->
    <div class="section">
      <h2>‡§§‡•Å‡§Æ‡§ö‡§æ ‡§´‡§æ‡§Ø‡§¶‡§æ</h2>
      <div class="cards-grid">
        <div class="card saving"><div class="label">‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§´‡§æ‡§Ø‡§¶‡§æ</div><div id="cardMonthly">‚Çπ0</div></div>
        <div class="card cons"><div class="label">Consistency Reward</div><div id="cardCons">‚Çπ0</div></div>
        <div class="card total"><div class="label">‡§è‡§ï‡•Ç‡§£ ‡§´‡§æ‡§Ø‡§¶‡§æ</div><div id="cardTotal">‚Çπ0</div></div>
        <div class="card secondary"><div class="label">‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§¨‡§ö‡§§</div><div id="cardAnnual">‚Çπ0</div></div>
        <div class="card secondary"><div class="label">40 ‡§µ‡§∞‡•ç‡§∑‡§æ‡§Ç‡§ö‡•Ä ‡§¨‡§ö‡§§</div><div id="cardForty">‚Çπ0</div></div>
      </div>
    </div>

    <!-- ACTIONS -->
    <div class="actions-row">
      <button id="waBtn" class="btn" style="background:#25D366;color:#fff;">WhatsApp</button>
      <button id="pdfBtn" class="btn" style="background:#ff7043;color:#fff;">PDF</button>
      <button id="clearBtn" class="btn" style="background:#d72626;color:#fff;">Clear</button>
    </div>

  </div> <!-- wrap -->

  <!-- POPUP -->
  <div id="overlay" class="overlay">
    <div class="popup">
      <h4 id="popTitle">‚úîÔ∏è ‡§ú‡•ã‡§°‡§≤‡•á</h4>
      <p id="popSub">‡§è‡§ï‡•Ç‡§£ ‡§¨‡§ö‡§§: ‚Çπ0</p>
    </div>
  </div>

  <!-- CONFETTI -->
  <div id="confetti"></div>

  <!-- FOOTER -->
  <div class="footer">
    <strong style="color:var(--primary)">Designed & Powered By DS WORLD üåç</strong>
    <div>üìû Contact: <b>7020970727</b></div>
  </div>

</div>

<!-- PDF Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<script>
// INITIAL
document.getElementById("orderDate").valueAsDate = new Date();
document.getElementById("nowDate").innerText =
  new Date().toLocaleDateString("mr-IN", { day:"2-digit", month:"short", year:"numeric" });

let products = [];
let order = [];
const CUR = "‚Çπ";

// Google Sheet Load
async function loadProductsFromSheet(){
  try{
    const res = await fetch(
      "https://docs.google.com/spreadsheets/d/1eR5THz-4AV3HkfnNJ5Un48ksz0I0jrepJSED3qHFg6k/gviz/tq?tqx=out:json"
    );
    const text = await res.text();
    const json = JSON.parse(text.substring(47, text.length - 2));
    const rows = json.table.rows || [];

    products = [];
    rows.forEach(r=>{
      const name = r.c[0]?.v || "";
      const market = Number(r.c[1]?.v || 0);
      const rcm = Number(r.c[2]?.v || 0);
      const pv = Number(r.c[3]?.v || 0);
      if(name) products.push({name,market,rcm,pv});
    });

    const sel = document.getElementById("productSelect");
    sel.innerHTML = "<option value=''>-- ‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§®‡§ø‡§µ‡§°‡§æ --</option>";
    products.forEach((p,i)=>{
      const o = document.createElement("option");
      o.value = i;
      o.text = p.name;
      sel.appendChild(o);
    });

  }catch(e){
    console.log("Sheet error", e);
  }
}
loadProductsFromSheet();

// Helpers
function fmt(v){ return Number(v||0).toFixed(0); }

// Recalc
function recalcAndRender(){
  const list = document.getElementById("productList");
  list.innerHTML = "";

  let sumQty=0, tM=0, tR=0, tPV=0, tSave=0;

  if(order.length === 0){
    list.innerHTML = `<div class="empty-msg">‡§ë‡§∞‡•ç‡§°‡§∞ ‡§∞‡§ø‡§ï‡§æ‡§Æ‡•Ä ‡§Ü‡§π‡•á</div>`;
  }

  order.forEach((it,idx)=>{
    const m = it.market * it.qty;
    const r = it.rcm * it.qty;
    const p = it.pv * it.qty;
    const s = (it.market - it.rcm) * it.qty;

    sumQty += it.qty;
    tM += m;
    tR += r;
    tPV += p;
    tSave += s;

    list.innerHTML += `
      <div class="product-item">
        <div class="product-header">
          <span class="product-name">${idx+1}. ${it.name}</span>
          <button class="btn-remove" data-i="${idx}">X</button>
        </div>
        <div class="product-body">
          <div class="qty-box">
            <label>Qty</label>
            <input class="inline-qty" type="number" min="1" value="${it.qty}" data-i="${idx}">
          </div>
          <div class="product-pricing">
            <div>RCM: ${CUR+fmt(it.rcm)} | ‡§Æ‡§æ‡§∞‡•ç‡§ï‡•á‡§ü: ${CUR+fmt(it.market)} | PV: ${fmt(it.pv)}</div>
            <div class="product-saving">‡§¨‡§ö‡§§: ${CUR+fmt(s)}</div>
          </div>
        </div>
      </div>
    `;
  });

  // Qty update
  document.querySelectorAll(".inline-qty").forEach(i=>{
    i.addEventListener("change", ()=>{
      const id = Number(i.dataset.i);
      order[id].qty = Math.max(1, Number(i.value)||1);
      recalcAndRender();
    });
  });

  // remove
  document.querySelectorAll(".btn-remove").forEach(b=>{
    b.addEventListener("click", ()=>{
      const id = Number(b.dataset.i);
      order.splice(id,1);
      recalcAndRender();
    });
  });

  // totals
  document.getElementById("totalQty").innerText = sumQty;
  document.getElementById("totalMarket").innerText = CUR+fmt(tM);
  document.getElementById("totalRCM").innerText = CUR+fmt(tR);
  document.getElementById("totalPV").innerText = fmt(tPV);
  document.getElementById("totalSaving").innerText = CUR+fmt(tSave);

  // consistency
  let cons=0;
  if(tPV < 1500) cons = tPV * 0.12;
  else if(tPV < 2500) cons = 1500 * 0.1667;
  else cons = 5000 * 0.1667;

  const combined = cons + tSave;

  document.getElementById("cardCons").innerText = CUR+fmt(cons);
  document.getElementById("cardMonthly").innerText = CUR+fmt(combined);
  document.getElementById("cardTotal").innerText = CUR+fmt(combined);
  document.getElementById("cardAnnual").innerText = CUR+fmt(combined * 12);
  document.getElementById("cardForty").innerText = CUR+fmt(combined * 12 * 40);
}

// Add product
document.getElementById("addBtn").addEventListener("click", ()=>{
  const idx = document.getElementById("productSelect").value;
  if(idx===""){ alert("‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§®‡§ø‡§µ‡§°‡§æ"); return; }

  const qty = Number(document.getElementById("qtyInput").value)||1;
  const p = products[idx];

  const ex = order.find(o=>o.name===p.name);
  if(ex) ex.qty += qty;
  else order.push({...p, qty});

  recalcAndRender();
  showPopup(p.name);
  confetti();
});

// Popup
function showPopup(name){
  document.getElementById("popTitle").innerText = "‚úîÔ∏è " + name;
  document.getElementById("popSub").innerText =
    "‡§è‡§ï‡•Ç‡§£ ‡§¨‡§ö‡§§: " + document.getElementById("totalSaving").innerText;

  const o = document.getElementById("overlay");
  o.style.display = "flex";
  setTimeout(()=>{ o.style.display = "none"; }, 3000);
}

// Confetti
function confetti(){
  const cont = document.getElementById("confetti");
  const emo = ["üéâ","‚ú®","üí∞","üéä"];
  for(let i=0;i<12;i++){
    let d = document.createElement("div");
    d.className = "confetti";
    d.style.left = (Math.random()*window.innerWidth)+"px";
    d.style.top = (Math.random()*window.innerHeight/2+200)+"px";
    d.innerText = emo[Math.floor(Math.random()*emo.length)];
    cont.appendChild(d);
    setTimeout(()=>{d.style.opacity=1; d.style.transform="translateY(-200px)";},20);
    setTimeout(()=>{d.remove();},1500);
  }
}

// WhatsApp
document.getElementById("waBtn").addEventListener("click", ()=>{
  const msg = 
`RCM Order Summary
Name: ${custName.value||""}
PV: ${totalPV.innerText}
Saving: ${totalSaving.innerText}

Generated by DS WORLD üåç`;

  window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`,"_blank");
});

// PDF
document.getElementById("pdfBtn").addEventListener("click", ()=>{
  html2pdf().from(document.querySelector(".wrap")).save();
});

// Clear
document.getElementById("clearBtn").addEventListener("click", ()=>{
  order = [];
  recalcAndRender();
});
</script>

</body>
  </html>
