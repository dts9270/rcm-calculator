<!-- ===== PART 1 of 3: HEAD + HEADER + PRODUCT-ADD UI ===== -->
<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DS WORLD ‚Äî RCM PRO MAX</title>

<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
/* ---------- THEME & BASE ---------- */
:root{
  --primary:#0a5b99;
  --accent:#0ea44a;
  --muted:#6b7280;
  --bg: linear-gradient(180deg,#dff1ff,#e7edff,#ece3ff);
  --text:#0f1724;
  --card-bg: rgba(255,255,255,0.55);
  --card-border: rgba(255,255,255,0.35);
  --shadow: 0 10px 30px rgba(15,40,80,0.12);
}
.dark{
  --bg: linear-gradient(180deg,#0c1016,#05060a);
  --text:#e7ebf2;
  --primary:#4fa7ff;
  --accent:#00ff99;
  --card-bg: rgba(30,35,42,0.55);
  --card-border: rgba(88,108,146,0.32);
}

/* Reset */
*{box-sizing:border-box}
body{
  margin:0;
  font-family:"Poppins",sans-serif;
  background:var(--bg);
  color:var(--text);
  -webkit-font-smoothing:antialiased;
}

/* Container */
.wrap{
  max-width:1150px;
  margin:18px auto;
  padding:16px;
}

/* Header */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  padding-bottom:12px;
}

/* Brand (logo + title) ‚Äî old UI look preserved */
.brand{
  display:flex;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
}
.logo{
  width:60px;
  height:60px;
  border-radius:12px;
  background:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  flex-shrink:0;
  box-shadow:0 6px 18px rgba(0,0,0,0.12);
}
.logo img{width:100%;height:100%;object-fit:contain}
.title{font-family:"Baloo 2"; font-size:20px; color:var(--primary)}
.now{font-size:13px;color:var(--muted)}

/* Theme toggle */
#themeToggle{
  padding:8px 12px;border-radius:10px;border:none;cursor:pointer;
  background:linear-gradient(90deg,var(--primary),#006bd6);color:#fff;font-weight:700;
  box-shadow:var(--shadow);
}

/* Grid layout */
.grid{
  display:grid;
  grid-template-columns:1fr 380px;
  gap:16px;
  align-items:start;
}

/* Card / panel */
.card{
  background:var(--card-bg);
  border:1px solid var(--card-border);
  padding:14px;border-radius:14px;
  box-shadow: var(--shadow);
}

/* Product-add area (left top) */
.controls{
  display:flex;
  gap:12px;
  align-items:flex-end;
  flex-wrap:wrap;
}
.controls select, .controls input[type="number"]{
  padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);
  font-size:14px;
}

/* Add button */
.btn{
  padding:10px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer;
}
.btn-primary{background:var(--primary);color:#fff}
.btn-ghost{background:#fff;border:1px solid var(--card-border);color:var(--primary)}

/* Product list placeholder */
#productList{margin-top:12px;max-height:420px;overflow:auto}

/* Mobile overrides (part 1) */
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
  .brand{flex-direction:column;align-items:center;text-align:center}
  .logo{width:52px;height:52px}
}
</style>
</head>

<body>
<div class="wrap">

  <!-- HEADER -->
  <div class="header">
    <div class="brand">
      <div class="logo"><img src="logo.png" alt="DS"></div>
      <div>
        <div class="title">RCM ‡§¨‡§ö‡§§ ‡§ï‡•Ö‡§≤‡•ç‡§ï‡•ç‡§Ø‡•Å‡§≤‡•á‡§ü‡§∞ (Pro Max)</div>
        <div class="now" id="nowDate"></div>
      </div>
    </div>

    <div style="display:flex;gap:8px;align-items:center">
      <button id="themeToggle" class="btn btn-ghost">üåô Dark</button>
      <div style="font-weight:800;color:var(--primary)">7020970727</div>
    </div>
  </div>

  <!-- MAIN GRID -->
  <div class="grid">

    <!-- LEFT COLUMN (products + list) -->
    <div class="card">

      <div style="margin-bottom:10px">
        <strong style="color:var(--primary);font-size:16px">‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§ç‡§° ‡§ï‡§∞‡§æ</strong>
        <div style="font-size:13px;color:var(--muted)">Quantity ‡§≠‡§∞‡§≤‡•ç‡§Ø‡§æ‡§®‡§Ç‡§§‡§∞ + ADD ‡§¶‡§æ‡§¨‡§æ</div>
      </div>

      <div class="controls">
        <div style="flex:1">
          <select id="productSelect">
            <option value="">Loading...</option>
          </select>
        </div>

        <div style="width:110px">
          <input id="qtyInput" type="number" value="1" min="1" />
        </div>

        <div style="width:110px">
          <button id="addBtn" class="btn btn-primary" style="width:100%">+ ADD</button>
        </div>
      </div>

      <div id="productList">
        <!-- items appended here -->
      </div>
      <!-- ===== PART 2 of 3: ORDER LIST + TOTALS + CARDS + ACTION BUTTONS ===== -->

      <!-- Totals summary -->
      <div style="margin-top:14px;border-top:2px solid rgba(0,0,0,0.04);padding-top:12px">
        <div style="display:flex;gap:10px;flex-wrap:wrap">
          <div style="flex:1;min-width:140px;padding:10px;border-radius:10px;background:rgba(255,255,255,0.6);font-weight:700">
            Qty: <span id="totalQty">0</span>
          </div>
          <div style="flex:1;min-width:140px;padding:10px;border-radius:10px;background:rgba(255,255,255,0.6);font-weight:700">
            Market: <span id="totalMarket">‚Çπ0</span>
          </div>
          <div style="flex:1;min-width:140px;padding:10px;border-radius:10px;background:rgba(255,255,255,0.6);font-weight:700">
            RCM: <span id="totalRCM">‚Çπ0</span>
          </div>
          <div style="flex:1;min-width:140px;padding:10px;border-radius:10px;background:rgba(255,255,255,0.6);font-weight:700">
            PV: <span id="totalPV">0</span>
          </div>
        </div>
      </div>

    </div> <!-- end left card -->

    <!-- RIGHT COLUMN -->
    <div>

      <div class="card">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">

          <div style="padding:12px;border-radius:12px;background:linear-gradient(135deg,#28c76f,#17a357);color:#fff;font-weight:700">
            <div style="font-size:13px">‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§´‡§æ‡§Ø‡§¶‡§æ</div>
            <div id="cardMonthly" style="font-size:20px;margin-top:8px">‚Çπ0</div>
          </div>

          <div style="padding:12px;border-radius:12px;background:linear-gradient(135deg,#9f59ff,#6d3be8);color:#fff;font-weight:700">
            <div style="font-size:13px">Consistency</div>
            <div id="cardCons" style="font-size:20px;margin-top:8px">‚Çπ0</div>
          </div>

          <div style="padding:12px;border-radius:12px;background:linear-gradient(135deg,#008cff,#0063d6);color:#fff;font-weight:700">
            <div style="font-size:13px">‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§´‡§æ‡§Ø‡§¶‡§æ</div>
            <div id="cardAnnual" style="font-size:20px;margin-top:8px">‚Çπ0</div>
          </div>

          <div style="padding:12px;border-radius:12px;background:linear-gradient(135deg,#ff9f50,#ff7b00);color:#fff;font-weight:700">
            <div style="font-size:13px">20 ‡§µ‡§∞‡•ç‡§∑‡•á ‡§¨‡§ö‡§§</div>
            <div id="cardTwenty" style="font-size:20px;margin-top:8px">‚Çπ0</div>
          </div>

        </div>

        <div style="margin-top:12px;display:flex;flex-direction:column;gap:10px">
          <button id="waBtn" class="btn btn-primary" style="width:100%;background:#25D366">üì≤ WhatsApp Share</button>
          <button id="orderBtn" class="btn btn-primary" style="width:100%;background:#0066cc">üìù Place Order</button>
          <button id="pdfBtn" class="btn btn-ghost" style="width:100%;background:#ff7a1c;color:#fff">üìÑ PDF</button>
          <button id="imgBtn" class="btn btn-ghost" style="width:100%;background:#4890ff;color:#fff">üñº Save Image</button>
          <button id="clearBtn" class="btn btn-ghost" style="width:100%;background:#ff4a4a;color:#fff">üóë Clear</button>
        </div>

      </div>

    </div> <!-- end right column -->

  </div> <!-- end grid -->

  <footer style="text-align:center;margin-top:16px;color:var(--muted);font-weight:700">
    Designed by DS WORLD üåç | 7020970727
  </footer>

</div> <!-- end wrap -->
   <!-- ===== PART 3 of 3: ORDER POPUP + SCRIPTS ===== -->

<!-- ORDER POPUP -->
<div id="orderPopup" style="display:none;position:fixed;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.35);display:flex;align-items:center;justify-content:center;z-index:2000">
  <div style="width:92%;max-width:420px;background:#fff;padding:18px;border-radius:12px;box-shadow:0 16px 40px rgba(0,0,0,0.18)">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3 style="margin:0;color:#0a5b99;font-family:'Baloo 2'">Place Order</h3>
      <button onclick="orderPopup.style.display='none'" style="border:none;background:transparent;font-size:18px">‚úñ</button>
    </div>

    <div style="margin-top:12px">
      <input id="custName" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï‡§æ‡§ö‡•á ‡§®‡§æ‡§µ *" style="width:100%;padding:10px;border:1px solid #ccc;border-radius:8px;margin-bottom:8px">
      <input id="abId" placeholder="AB ID *" style="width:100%;padding:10px;border:1px solid #ccc;border-radius:8px;margin-bottom:8px">
      <input id="mob" placeholder="Mobile *" style="width:100%;padding:10px;border:1px solid #ccc;border-radius:8px;margin-bottom:8px">
      <textarea id="addr" rows="3" placeholder="Address *" style="width:100%;padding:10px;border:1px solid #ccc;border-radius:8px"></textarea>
    </div>

    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button onclick="orderPopup.style.display='none'" style="padding:10px 12px;border-radius:8px;border:1px solid #ccc;background:#fff">Cancel</button>
      <button id="orderPlace" style="padding:10px 14px;border-radius:8px;border:none;background:#0a5b99;color:#fff;font-weight:700">Place Order</button>
    </div>
  </div>
</div>

<!-- LIBRARIES -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<script>
/* ---------- HELPERS ---------- */
const el = id => document.getElementById(id);
const fmt = n => Math.round(n).toLocaleString('en-IN');

/* TIME */
el('nowDate').innerText = new Date().toLocaleString('mr-IN',{day:'2-digit',month:'short',year:'numeric',hour:'2-digit',minute:'2-digit'});

/* THEME TOGGLE */
el('themeToggle').onclick = ()=>{
  document.body.classList.toggle('dark');
  el('themeToggle').innerText = document.body.classList.contains('dark') ? '‚òÄÔ∏è Light' : 'üåô Dark';
};

/* GOOGLE SHEET CONFIG */
const SHEET_ID = "1eR5THz-4AV3HkfnNJ5Un48ksz0I0jrepJSED3qHFg6k";
const RAW = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;
const SHEET_URL = "https://api.allorigins.win/raw?url=" + encodeURIComponent(RAW);

/* STATE */
let products = [];
let order = [];

/* LOAD PRODUCTS FROM GOOGLE SHEET (fallback built-in if fails) */
async function loadProducts(){
  try{
    const r = await fetch(SHEET_URL);
    const t = await r.text();
    const j = JSON.parse(t.substring(47,t.length-2));
    products = j.table.rows.map(r=>({
      name: r.c[0]?.v || "",
      market: +r.c[1]?.v || 0,
      rcm: +r.c[2]?.v || 0,
      pv: +r.c[3]?.v || 0
    }));
  }catch(e){
    // fallback list (small)
    products = [
      {name:"‡§ü‡§æ‡§ü‡§æ ‡§Æ‡•Ä‡§† 1 ‡§ï‡§ø‡§≤‡•ã",market:30,rcm:20,pv:7},
      {name:"‡§∞‡•á‡§° ‡§≤‡•á‡§¨‡§≤ ‡§ö‡§π‡§æ 500g",market:310,rcm:240,pv:120},
      {name:"‡§Ö‡§Ç‡§¨‡§æ‡§∞‡•Ä ‡§Æ‡§ø‡§∞‡§ö‡•Ä 200g",market:108,rcm:80,pv:48}
    ];
  }
  el('productSelect').innerHTML = `<option value="">-- Product ‡§®‡§ø‡§µ‡§°‡§æ --</option>` + products.map((p,i)=>`<option value="${i}">${p.name}</option>`).join('');
}
loadProducts();

/* ADD PRODUCT */
el('addBtn').onclick = ()=>{
  const idx = el('productSelect').value;
  if(idx===""||idx===null){ alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§®‡§ø‡§µ‡§°‡§æ'); return; }
  const qty = Math.max(1,parseInt(el('qtyInput').value)||1);
  const p = products[Number(idx)];
  const existing = order.find(o=>o.name===p.name);
  if(existing) existing.qty += qty; else order.push({...p, qty});
  calc();
  el('productSelect').selectedIndex = 0;
  el('qtyInput').value = 1;
};

/* CALCULATION & RENDER */
function calculateConsistency(tPV){
  let cons = 0;
  if(tPV < 1500) cons = tPV * 0.12;
  else if(tPV >=1500 && tPV < 2500) cons = 1500 * 0.1667;
  else cons = 5000 * 0.1667;
  return cons;
}

function calc(){
  const list = el('productList');
  list.innerHTML = '';
  let sumQty=0, tM=0, tR=0, tPV=0, tSave=0;
  if(order.length===0){
    list.innerHTML = '<div style="text-align:center;color:var(--muted);padding:18px">‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§ë‡§∞‡•ç‡§°‡§∞ ‡§∞‡§ø‡§ï‡§æ‡§Æ‡•Ä ‡§Ü‡§π‡•á. ‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§ç‡§° ‡§ï‡§∞‡§æ.</div>';
  }
  order.forEach((it, idx)=>{
    const marketSum = it.market * it.qty;
    const rcmSum = it.rcm * it.qty;
    const pvSum = it.pv * it.qty;
    const saveSum = (it.market - it.rcm) * it.qty;
    sumQty += it.qty; tM += marketSum; tR += rcmSum; tPV += pvSum; tSave += saveSum;
    const itemDiv = document.createElement('div');
    itemDiv.className = 'product-item';
    itemDiv.innerHTML = `
      <div>
        <div class="product-title">${idx+1}. ${it.name}</div>
        <div class="product-meta">PV: ${it.pv} | M: ‚Çπ${fmt(it.market)} | R: ‚Çπ${fmt(it.rcm)}</div>
      </div>
      <div style="text-align:right">
        <div class="qty-controls">
          <button class="btn-ghost" onclick="order[${idx}].qty=Math.max(1,order[${idx}].qty-1);calc()">-</button>
          <input type="number" min="1" value="${it.qty}" onchange="order[${idx}].qty=this.value;calc()" style="width:60px;text-align:center;padding:6px;border-radius:8px;border:1px solid var(--card-border)">
          <button class="btn-ghost" onclick="order[${idx}].qty++;calc()">+</button>
        </div>
        <div style="margin-top:6px;font-weight:700;color:var(--accent)">‚Çπ${fmt(saveSum)}</div>
      </div>
    `;
    list.appendChild(itemDiv);
  });

  el('totalQty').innerText = sumQty;
  el('totalMarket').innerText = '‚Çπ'+fmt(tM);
  el('totalRCM').innerText = '‚Çπ'+fmt(tR);
  el('totalPV').innerText = fmt(tPV);

  const cons = calculateConsistency(tPV);
  const monthly = tSave + cons;
  el('cardMonthly').innerText = '‚Çπ'+fmt(monthly);
  el('cardCons').innerText = '‚Çπ'+fmt(cons);
  el('cardAnnual').innerText = '‚Çπ'+fmt(monthly*12);
  el('cardTwenty').innerText = '‚Çπ'+fmt(monthly*12*20);
}

/* CLEAR ORDER */
el('clearBtn').onclick = ()=>{ if(confirm('Clear ‡§ï‡§∞‡§æ‡§Ø‡§ö‡•á?')){ order=[]; calc(); } };

/* WHATSAPP SHARE (TABLE TEXT) */
el('waBtn').onclick = ()=>{
  if(order.length===0){ alert('Order ‡§∞‡§ø‡§ï‡§æ‡§Æ‡•Ä ‡§Ü‡§π‡•á'); return; }
  let msg = '--------------------------------\\nRCM Order Summary ‚Äî DS WORLD\\n--------------------------------\\n';
  order.forEach((it, i)=>{
    msg += `\\n${i+1}) ${it.name}\\nQty: ${it.qty}\\nMarket: ‚Çπ${it.market}\\nRCM: ‚Çπ${it.rcm}\\nPV: ${it.pv}\\nSaving: ‚Çπ${(it.market-it.rcm)*it.qty}\\n--------------------------------`;
  });
  msg += `\\nTotal Market: ${el('totalMarket').innerText}\\nTotal RCM: ${el('totalRCM').innerText}\\nTotal PV: ${el('totalPV').innerText}\\n\\nMonthly Benefit: ${el('cardMonthly').innerText}\\nYearly: ${el('cardAnnual').innerText}\\n20-Year: ${el('cardTwenty').innerText}\\n\\n‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!\\nDS WORLD üåç`;
  window.open('https://wa.me/?text='+encodeURIComponent(msg));
};

/* ORDER FORM (popup open) */
el('orderBtn').onclick = ()=> el('orderPopup').style.display = 'flex';

/* PLACE ORDER (send to your whatsapp number) */
el('orderPlace').onclick = ()=>{
  const n = el('custName').value.trim();
  const id = el('abId').value.trim();
  const m = el('mob').value.trim();
  const a = el('addr').value.trim();
  if(!n || !id || !m || !a){ alert('‡§∏‡§∞‡•ç‡§µ ‡§´‡•Ä‡§≤‡•ç‡§° ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§Ü‡§π‡•á‡§§!'); return; }
  let msg = `üìù ORDER REQUEST ‚Äî DS WORLD\\n--------------------------------\\nName: ${n}\\nAB ID: ${id}\\nMobile: ${m}\\nAddress: ${a}\\n--------------------------------\\n\\n`;
  order.forEach((it,i)=>{ msg += `${i+1}) ${it.name} ‚Äî ${it.qty} | PV: ${it.pv} | Saving: ‚Çπ${(it.market-it.rcm)*it.qty}\\n`; });
  msg += `\\nTotal PV: ${el('totalPV').innerText}\\nMonthly: ${el('cardMonthly').innerText}\\nYearly: ${el('cardAnnual').innerText}\\n\\nSend via Pro Max App`;
  window.open('https://wa.me/7020970727?text='+encodeURIComponent(msg));
  el('orderPopup').style.display = 'none';
};

/* IMAGE EXPORT */
el('imgBtn').onclick = ()=> html2canvas(document.querySelector('.wrap')).then(c=>{ const a=document.createElement('a'); a.href=c.toDataURL(); a.download='RCM_Order.png'; a.click(); });

/* PDF EXPORT (simple full page) */
el('pdfBtn').onclick = ()=> html2pdf().from(document.querySelector('.wrap')).save('RCM_Invoice.pdf');

/* INITIAL small sample if needed */
window.addEventListener('load', ()=> {
  // ensure loadProducts() ran and list ready
  // calc initially
  calc();
});

</script>
</body>
</html>
