<!doctype html>
<html lang="mr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DS WORLD - RCM PRO MAX (Final)</title>

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@300;400;500;600;700&family=Baloo+2:wght@600;700&display=swap" rel="stylesheet">

<style>
/* THEME */
:root{
  --primary:#0a5b99;
  --accent:#0ea44a;
  --muted:#6b7280;
  --bg: linear-gradient(180deg,#dff1ff,#e7edff,#ece3ff);
  --text:#0f1724;
  --card-bg: rgba(255,255,255,0.55);
  --card-blur: blur(12px);
  --card-border: rgba(255,255,255,0.4);
  --shadow: 0 10px 30px rgba(15,40,80,0.15);
}
.dark{
  --bg: linear-gradient(180deg,#0c1016,#05060a);
  --text:#e7ebf2;
  --primary:#4fa7ff;
  --accent:#00ff99;
  --card-bg: rgba(40,45,55,0.55);
  --card-border: rgba(100,110,130,0.3);
}

/* BODY */
body{
  margin:0;
  font-family:"Noto Sans Devanagari","Poppins",sans-serif;
  background:var(--bg);
  color:var(--text);
  transition:0.3s;
}

/* WRAPPER */
.wrap{max-width:1100px;margin:16px auto;padding:16px}

/* HEADER */
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.brand{display:flex;align-items:center;gap:18px}

/* ‚≠ê BIG CLEAN LOGO */
.logo{
  width:95px;
  height:95px;
  border-radius:18px;
  background:white;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:8px;
  box-shadow:0 6px 20px rgba(0,0,0,0.15);
}
.logo img{
  width:100%;
  height:100%;
  object-fit:contain;
}

h1{
  margin:0;
  font-family:"Baloo 2";
  color:var(--primary);
}

.ds-badge{
  padding:8px 14px;
  background:linear-gradient(90deg,var(--primary),#0078d1);
  color:white;
  border-radius:30px;
  font-weight:700;
}

#themeToggle{
  padding:8px 14px;
  border-radius:30px;
  border:none;
  background:linear-gradient(135deg,#007ee9,#005bb8);
  color:white;
  font-weight:700;
  cursor:pointer;
}

/* GRID */
.grid{
  display:grid;
  grid-template-columns:1fr 360px;
  gap:16px;
}
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
}

/* CARD */
.card{
  padding:16px;
  border-radius:14px;
  background:var(--card-bg);
  backdrop-filter:var(--card-blur);
  border:1px solid var(--card-border);
  box-shadow:var(--shadow);
}

/* INPUTS */
.row{display:flex;gap:12px;flex-wrap:wrap}
.field{flex:1}
label{font-size:13px;color:var(--muted);margin-bottom:6px;display:block}
input,select{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid rgba(0,0,0,0.12);
  font-size:15px;
  background:white;
}

/* PRODUCT LIST */
#productList{
  max-height:360px;
  overflow:auto;
  margin-top:14px;
  padding-right:6px;
}

/* ‚≠ê PREMIUM PRODUCT CARD */
.prod-item{
  display:flex;
  justify-content:space-between;
  gap:14px;
  padding:16px;
  border-radius:14px;
  background:rgba(255,255,255,0.95);
  border:1px solid rgba(0,0,0,0.08);
  margin-bottom:12px;
  box-shadow:0 4px 10px rgba(0,0,0,0.06);
}

.prod-left{flex:1}

.prod-title{
  font-size:17px;
  font-weight:700;
  color:var(--primary);
}
.prod-sub{
  font-size:13px;
  margin-top:5px;
  color:var(--muted);
}

/* RIGHT SIDE */
.prod-right{text-align:right;min-width:120px}

/* QTY BUTTONS */
.qty-controls{
  display:flex;
  gap:8px;
  align-items:center;
  margin-bottom:6px;
}

.qty-controls input{
  width:52px;
  padding:6px;
  text-align:center;
  border-radius:8px;
  border:1px solid rgba(0,0,0,0.2);
}

.btn-ghost{
  padding:6px 12px;
  font-size:18px;
  font-weight:800;
  border-radius:8px;
  border:1px solid rgba(0,0,0,0.12);
  background:white;
  cursor:pointer;
}

.prod-save{
  font-size:16px;
  font-weight:800;
  color:var(--accent);
}

/* SUMMARY */
.summary{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin-top:14px;
}

.sum-box{
  padding:12px;
  background:white;
  border-radius:12px;
  text-align:center;
  font-weight:700;
}

/* CARDS */
.cards{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}

.big-card{
  padding:16px;
  border-radius:14px;
  color:white;
}

.card-saving{background:linear-gradient(135deg,#27c76f,#0ea44a)}
.card-cons{background:linear-gradient(135deg,#9f59ff,#6d3be8)}
.card-year{background:linear-gradient(135deg,#2fa3ff,#006fdb)}
.card-life{background:linear-gradient(135deg,#ffae4d,#ff8100)}

.big-card .label{font-size:13px}
.big-card .val{font-size:28px;font-weight:800;margin-top:5px}

/* BOTTOM BTNS */
.ios-btn{
  width:100%;
  padding:14px;
  border-radius:12px;
  font-weight:800;
  font-size:16px;
  margin-bottom:10px;
  border:none;
  color:white;
}

.ios-wa{background:#1bcc4e}
.ios-img{background:#2f7aff}
.ios-pdf{background:#ff9b30}
.ios-clear{background:#ff4a4a}

/* FLOAT */
#floatAdd{
  position:fixed;
  right:18px;
  bottom:18px;
  width:64px;
  height:64px;
  border-radius:50%;
  background:linear-gradient(135deg,#0a5b99,#006fbd);
  color:white;
  border:none;
  font-size:34px;
  box-shadow:0 12px 28px rgba(0,0,0,0.2);
  cursor:pointer;
  z-index:1200;
}

/* POPUP */
#popup{
  position:fixed;
  left:50%;
  top:16%;
  transform:translateX(-50%);
  background:white;
  padding:10px 16px;
  border-radius:10px;
  color:var(--primary);
  display:none;
  font-weight:700;
  z-index:2000;
}

/* SPLASH */
#splash{
  position:fixed;
  left:0;top:0;
  width:100%;height:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  background:#f7fbff;
  z-index:3000;
}
</style>
</head>
<body>

<!-- SPLASH -->
<div id="splash">
  <div class="logo"><img src="logo.png"></div>
  <h3 style="font-family:'Baloo 2';color:var(--primary);margin-top:12px">
    DS WORLD ‚Äî RCM PRO MAX
  </h3>
</div>

<!-- MAIN APP -->
<div class="wrap" id="app" style="display:none">

<header>
  <div class="brand">
    <div class="logo"><img src="logo.png"></div>
    <div>
      <h1>RCM ‡§¨‡§ö‡§§ ‡§ï‡•Ö‡§≤‡•ç‡§ï‡•ç‡§Ø‡•Å‡§≤‡•á‡§ü‡§∞ (Pro Max)</h1>
      <div id="nowDate" style="font-size:13px;color:var(--muted)"></div>
    </div>
  </div>

  <div style="display:flex;gap:10px;align-items:center">
    <button id="themeToggle">üåô DARK</button>
    <div class="ds-badge">DS WORLD</div>
  </div>
</header>

<div class="grid">

  <!-- LEFT -->
  <div class="card">
    <div class="row">
      <div class="field">
        <label>‡§ó‡•ç‡§∞‡§æ‡§π‡§ï‡§æ‡§ö‡•á ‡§®‡§æ‡§µ</label>
        <input id="custName">
      </div>
      <div class="field">
        <label>RCM ID</label>
        <input id="rcmId">
      </div>
      <div class="field">
        <label>‡§§‡§æ‡§∞‡•Ä‡§ñ</label>
        <input id="orderDate" type="date">
      </div>
    </div>

    <h3 style="margin-top:14px;color:var(--primary)">‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§∂‡•ã‡§ß‡§æ</h3>
    <input id="search" placeholder="Type to search..." style="margin-top:8px">

    <div class="row" style="margin-top:10px">
      <select id="productSelect" style="flex:1"><option>Loading...</option></select>
      <input id="qtyInput" type="number" min="1" value="1" style="width:80px">
      <button id="addBtn" class="btn-add">+ ADD</button>
    </div>

    <div id="productList"></div>

    <div class="summary">
      <div class="sum-box" id="totalQty">Qty: 0</div>
      <div class="sum-box" id="totalMarket">Market: ‚Çπ0</div>
      <div class="sum-box" id="totalRCM">RCM: ‚Çπ0</div>
      <div class="sum-box" id="totalPV">PV: 0</div>
    </div>

  </div>

  <!-- RIGHT -->
  <div>
    <div class="card">
      <div class="cards">
        <div class="big-card card-saving">
          <div class="label">‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§´‡§æ‡§Ø‡§¶‡§æ</div>
          <div id="cardMonthly" class="val">‚Çπ0</div>
        </div>

        <div class="big-card card-cons">
          <div class="label">Consistency</div>
          <div id="cardCons" class="val">‚Çπ0</div>
        </div>
      </div>

      <div class="cards" style="margin-top:12px">
        <div class="big-card card-year">
          <div class="label">‡§µ‡§æ‡§∞‡•ç‡§∑‡§ø‡§ï ‡§´‡§æ‡§Ø‡§¶‡§æ</div>
          <div id="cardAnnual" class="val">‚Çπ0</div>
        </div>

        <div class="big-card card-life">
          <div class="label">20 ‡§µ‡§∞‡•ç‡§∑‡•á ‡§´‡§æ‡§Ø‡§¶‡§æ</div>
          <div id="cardTwenty" class="val">‚Çπ0</div>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <button id="waBtn" class="ios-btn ios-wa">üì≤ WhatsApp</button>
      <button id="imgBtn" class="ios-btn ios-img">üñº Image</button>
      <button id="pdfBtn" class="ios-btn ios-pdf">üìÑ PDF Bill</button>
      <button id="clearBtn" class="ios-btn ios-clear">üóë Clear</button>
    </div>
  </div>

</div>

<footer style="text-align:center;margin-top:20px;color:#666;font-weight:700">
  Designed by DS WORLD üåç | 7020970727
</footer>

</div>

<button id="floatAdd">+</button>

<div id="popup"></div>
<div id="confetti"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<script>
const el=id=>document.getElementById(id);
const fmt=n=>Math.round(n).toLocaleString('en-IN');

/* Google Sheet */
const SHEET_ID="1eR5THz-4AV3HkfnNJ5Un48ksz0I0jrepJSED3qHFg6k";
const RAW_GVIZ=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;
const SHEET_URL="https://api.codetabs.com/v1/proxy?quest="+encodeURIComponent(RAW_GVIZ);

let products=[];
let order=[];

function parseGviz(text){
  try{
    const a=text.indexOf('{'), b=text.lastIndexOf('}');
    return JSON.parse(text.substring(a,b+1));
  }catch(e){return null;}
}

/* Load Product List */
async function loadProducts(){
  try{
    const res=await fetch(SHEET_URL);
    const txt=await res.text();
    const json=parseGviz(txt);
    products=json.table.rows.map(r=>({
      name:r.c[0]?.v||"",
      market:+(r.c[1]?.v||0),
      rcm:+(r.c[2]?.v||0),
      pv:+(r.c[3]?.v||0)
    })).filter(p=>p.name.trim()!=="");
  }catch(e){
    alert("Google Sheet load ‡§π‡•ã‡§§ ‡§®‡§æ‡§π‡•Ä");
  }
  populateDropdown();
  calc();
}

/* Dropdown Fill */
function populateDropdown(){
  const sel=el('productSelect');
  sel.innerHTML="<option value=''>-- ‡§®‡§ø‡§µ‡§°‡§æ --</option>";
  products.forEach((p,i)=>{
    const o=document.createElement("option");
    o.value=i;
    o.textContent=p.name;
    sel.appendChild(o);
  });
}

/* Search */
el('search').oninput=()=>{
  const q=el('search').value.toLowerCase();
  const sel=el('productSelect');
  sel.innerHTML="<option value=''>-- ‡§®‡§ø‡§µ‡§°‡§æ --</option>";
  products.forEach((p,i)=>{
    if(p.name.toLowerCase().includes(q)){
      const o=document.createElement("option");
      o.value=i;
      o.textContent=p.name;
      sel.appendChild(o);
    }
  });
};

/* Add Product */
el('addBtn').onclick=addProduct;
el('floatAdd').onclick=addProduct;

function addProduct(){
  const idx=el('productSelect').value;
  if(idx==="") return alert("‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§®‡§ø‡§µ‡§°‡§æ");

  const qty=Math.max(1,+el('qtyInput').value||1);
  const p=products[idx];

  const ex=order.find(x=>x.name===p.name);
  if(ex) ex.qty+=qty;
  else order.push({...p,qty});

  showPopup("Product Added");
  calc();
}

/* Popup */
function showPopup(t){
  const p=el('popup');
  p.innerText="‚úî "+t;
  p.style.display="block";
  setTimeout(()=>p.style.display="none",1000);
}

/* CALC */
function calc(){
  const list=el('productList');
  list.innerHTML="";

  let TQ=0, TM=0, TR=0, TPV=0, SAVE=0;

  order.forEach((it,i)=>{
    const m=it.market*it.qty;
    const r=it.rcm*it.qty;
    const pv=it.pv*it.qty;
    const s=(it.market-it.rcm)*it.qty;

    TQ+=it.qty;
    TM+=m;
    TR+=r;
    TPV+=pv;
    SAVE+=s;

    const div=document.createElement("div");
    div.className="prod-item";

    div.innerHTML=`
      <div class="prod-left">
        <div class="prod-title">${it.name}</div>
        <div class="prod-sub">
          PV: ${it.pv} | M: ‚Çπ${it.market} | RCM: ‚Çπ${it.rcm}
        </div>
      </div>
      <div class="prod-right">
        <div class="qty-controls">
          <button class="btn-ghost" data-i="${i}" data-a="minus">-</button>
          <input class="inline-qty" data-i="${i}" type="number" value="${it.qty}">
          <button class="btn-ghost" data-i="${i}" data-a="plus">+</button>
        </div>
        <div class="prod-save">‚Çπ${fmt(s)}</div>
      </div>
    `;

    list.appendChild(div);
  });

  el('totalQty').innerText="Qty: "+TQ;
  el('totalMarket').innerText="Market: ‚Çπ"+fmt(TM);
  el('totalRCM').innerText="RCM: ‚Çπ"+fmt(TR);
  el('totalPV').innerText="PV: "+fmt(TPV);

  /* Consistency */
  let CONS=0;
  if(TPV<1500) CONS=TPV*0.12;
  else if(TPV<2500) CONS=1500*0.1667;
  else CONS=5000*0.1667;

  const MONTH=SAVE+CONS;

  el('cardCons').innerText="‚Çπ"+fmt(CONS);
  el('cardMonthly').innerText="‚Çπ"+fmt(MONTH);
  el('cardAnnual').innerText="‚Çπ"+fmt(MONTH*12);
  el('cardTwenty').innerText="‚Çπ"+fmt(MONTH*12*20);

  document.querySelectorAll(".btn-ghost").forEach(btn=>{
    btn.onclick=()=>{
      const i=btn.dataset.i, a=btn.dataset.a;
      if(a==="plus") order[i].qty++;
      else order[i].qty=Math.max(1,order[i].qty-1);
      calc();
    };
  });

  document.querySelectorAll(".inline-qty").forEach(inp=>{
    inp.onchange=()=>{
      const i=inp.dataset.i;
      order[i].qty=Math.max(1,+inp.value||1);
      calc();
    };
  });
}

/* 4 BUTTON FEATURES */

/* WhatsApp */
el('waBtn').onclick=()=>{
  if(order.length===0) return alert("‡§ï‡§æ‡§π‡•Ä‡§π‡•Ä ‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§®‡§æ‡§π‡•Ä‡§§");

  let msg="*RCM Order Summary*%0A%0A";
  order.forEach((p,i)=> msg+=`${i+1}. ${p.name} √ó ${p.qty}%0A`);
  msg+=`%0ATotal PV: ${fmt(order.reduce((s,x)=>s+x.pv*x.qty,0))}`;
  msg+=`%0AMonthly Benefit: ${el('cardMonthly').innerText}`;

  window.open("https://wa.me/?text="+msg,"_blank");
};

/* IMAGE */
el('imgBtn').onclick=()=>{
  html2canvas(document.querySelector('.wrap')).then(canvas=>{
    const a=document.createElement('a');
    a.href=canvas.toDataURL("image/png");
    a.download="RCM_Order.png";
    a.click();
  });
};

/* PDF */
el('pdfBtn').onclick=()=>{
  if(order.length===0) return alert("Products ‡§®‡§æ‡§π‡•Ä‡§§");

  html2pdf()
    .from(document.querySelector('.wrap'))
    .set({margin:10,filename:"RCM_Order.pdf",html2canvas:{scale:1.2}})
    .save();
};

/* CLEAR */
el('clearBtn').onclick=()=>{
  if(confirm("‡§∏‡§ó‡§≥‡•Ä ‡§™‡•ç‡§∞‡•â‡§°‡§ï‡•ç‡§ü ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§∏‡§æ‡§´ ‡§ï‡§∞‡§æ‡§Ø‡§ö‡•Ä ‡§ï‡§æ?")){
    order=[];
    calc();
  }
};

/* INIT */
window.onload=()=>{
  el('orderDate').valueAsDate=new Date();
  el('nowDate').innerText=new Date().toLocaleString();

  setTimeout(()=>{
    el('splash').style.display="none";
    el('app').style.display="block";
    loadProducts();
  },800);
};
</script>
</body>
   </html>
